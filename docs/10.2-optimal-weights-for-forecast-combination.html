<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="10.2 Optimal Weights for Forecast Combination | Educated Guess" />
<meta property="og:type" content="book" />
<meta property="og:image" content="/forecasting-logo.png" />
<meta property="og:description" content="Forecasting With Time Series Models Using R" />


<meta name="author" content="David Ubilava" />


<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<meta name="description" content="Forecasting With Time Series Models Using R">

<title>10.2 Optimal Weights for Forecast Combination | Educated Guess</title>

<link href="libs/tufte-css-2015.12.29/tufte-fonts.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte-background.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte-italics.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte.css" rel="stylesheet" />


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />

</head>

<body>



<div class="row">
<div class="col-sm-12">
<!--bookdown:toc:end-->
<!--bookdown:toc:start-->
</div>
</div>
<div class="row">
<div class="col-sm-12">
<div id="optimal-weights-for-forecast-combination" class="section level2" number="10.2">
<h2><span class="header-section-number">10.2</span> Optimal Weights for Forecast Combination</h2>
<p>Forecast combination implies mixing the forecasts from different models with some proportions. In other words, a combined forecast is a weighted sum of the individual forecasts. The weights need to be selected in a way that maximizes the combined forecast accuracy, i.e., minimizes the combined forecast loss.</p>
<p>Consider two forecasting methods (or models), <span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span>, each respectively yielding one-step-ahead forecasts <span class="math inline">\(y_{a,t+1|t}\)</span> and <span class="math inline">\(y_{b,t+1|t}\)</span>, and the associated forecast errors <span class="math inline">\(e_{a,t+1} = y_{t+1}-y_{a,t+1|t}\)</span> and <span class="math inline">\(e_{b,t+1} = y_{t+1}-y_{b,t+1|t}\)</span>.</p>
<p>A combined forecast, <span class="math inline">\(y_{c,t+1|t}\)</span>, is the weighted sum of these two forecasts: <span class="math display">\[y_{c,t+1|t} = (1-w)y_{a,t+1|t} + w y_{b,t+1|t},\]</span> where the usual assumption about the weights apply, i.e., <span class="math inline">\(0 \leq w \leq 1\)</span>.<label for="tufte-sn-18" class="margin-toggle sidenote-number">18</label><input type="checkbox" id="tufte-sn-18" class="margin-toggle"><span class="sidenote"><span class="sidenote-number">18</span> More broadly, if we have <span class="math inline">\(n\)</span> forecasts that we intend to combine, the associated weights, <span class="math inline">\(w_i:i=1,\ldots,n\)</span>, will each be bounded by zero and one, and together they will add up to one.</span></p>
<p>A combined forecast error is the weighted sum of the individual forecast errors: <span class="math display">\[e_{c,t+1} = (1-w)e_{a,t+1} + w e_{b,t+1}\]</span></p>
<p>The combined forecast error is, on average, zero (assuming that the individual forecasts are all unbiased): <span class="math display">\[E\left(e_{c,t+1}\right) = E\left[(1-w)e_{a,t+1} + w e_{b,t+1}\right] = 0\]</span></p>
<p>The variance of a combined forecast error is: <span class="math display">\[Var\left(e_{c,t+1}\right) = (1-w)^2 \sigma_a^2 + w^2  \sigma_b^2 + 2w(1-w)\sigma_{ab},\]</span> where <span class="math inline">\(\sigma_a\)</span> and <span class="math inline">\(\sigma_b\)</span> are the standard deviations of the forecast errors from models <span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span>, and <span class="math inline">\(\sigma_{ab}=\rho_{ab}\sigma_a\sigma_b\)</span> is the covariance of the two forecast errors, which can also be expressed as a product of the correlation between the two forecast errors, <span class="math inline">\(\rho_{ab}\)</span>, and the standard deviations of each forecast error.</p>
<p>By taking the derivative of the combined forecast error variance, and equating it to zero, we obtain the optimal weight (which minimizes the combined forecast error variance): <span class="math display">\[w^* = \frac{\sigma_a^2-\sigma_{ab}}{\sigma_a^2+\sigma_b^2-2\sigma_{ab}}\]</span></p>
<p>A couple of features of interest become immediately apparent. First, when the two forecast errors are uncorrelated, the optimal weight assigned to the individual forecast is inversely proportional to the forecast error variance. Second, when the two forecast errors have the same variance, the optimal weight assigned to each individual forecast is equal to 0.5.</p>
<p>Substitute <span class="math inline">\(w^*\)</span> in place of <span class="math inline">\(w\)</span> in the formula for variance to obtain: <span class="math display">\[Var\left[e_{c,t+1}(w^*)\right] = \sigma_c^2(w^*) = \frac{\sigma_a^2\sigma_b^2(1-\rho^2)}{\sigma_a^2+\sigma_b^2-2\rho\sigma_a\sigma_b}\]</span></p>
<p>It can be shown that <span class="math inline">\(\sigma_c^2(w^*) \leq \min\{\sigma_a^2,\sigma_b^2\}\)</span>. That is to say that by combining forecasts we are not making things worse (so long as we use <em>optimal</em> weights).</p>
<p>In practice <span class="math inline">\(\sigma_a\)</span>, <span class="math inline">\(\sigma_b\)</span>, and <span class="math inline">\(sigma_{ab}\)</span> are unknown. So, we estimate these using a pseudo-forecasting routine. Specifically, the sample estimator of <span class="math inline">\(w^*\)</span> is: <span class="math display">\[\hat{w}^* = \frac{\hat{\sigma}_i^2-\hat{\sigma}_{ij}}{\hat{\sigma}_i^2+\hat{\sigma}_j^2-2\hat{\sigma}_{ij}},\]</span> where <span class="math inline">\(\hat{\sigma}_i^2 = \frac{1}{P-1}\sum_{t=R}^{R+P-1}{e_{a,t+1}^2}\)</span> and <span class="math inline">\(\hat{\sigma}_j^2 = \frac{1}{P-1}\sum_{t=R}^{R+P-1}{e_{b,t+1}^2}\)</span> are sample forecast error variances, and <span class="math inline">\(\hat{\sigma}_{ij}=\frac{1}{P-1}\sum_{t=R}^{R+P-1}{e_{a,t+1}e_{b,t+1}}\)</span> is a sample forecast error covariance, where <span class="math inline">\(P\)</span> denotes the number of out-of-sample forecasts.</p>
<p>The optimal weight has a straightforward interpretation in a regression setting. Consider the combined forecast equation as: <span class="math display">\[y_{t+1} = (1-w)y_{a,t+1|t} + w y_{b,t+1|t} + \varepsilon_{t+1},\]</span> where <span class="math inline">\(\varepsilon_{t+1}\equiv e_{c,t+1}\)</span>. We can re-arrange the equation so that: <span class="math display">\[e_{a,t+1} = w (y_{b,t+1|t}-y_{a,t+1|t}) + \varepsilon_{t+1},\]</span> where <span class="math inline">\(w\)</span> is obtained by estimating a linear regression with an intercept restricted to zero.</p>
<p>Alternatively, we can estimate an unconstrained variant of the combined forecast equation: <span class="math display">\[y_{t+1} = \alpha+\beta_a y_{a,t+1|t} + \beta_b y_{b,t+1|t} + \varepsilon_{t+1},\]</span> which relaxes the assumption that the forecasts are unbiased, as well as that the weights need to add up to one. Indeed, this unconstrained variant for forecast combination allows for the possibility of negative weights.</p>
</div>
<p style="text-align: center;">
<a href="10.1-benefits-of-forecast-combination.html"><button class="btn btn-default">Previous</button></a>
<a href="10.3-forecast-encompassing.html"><button class="btn btn-default">Next</button></a>
</p>
</div>
</div>



</body>
</html>
