<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Tutorial 8: Threshold Autoregression | Educated Guess</title>
  <meta name="description" content="Forecasting With Time Series Models Using R" />
  <meta name="generator" content="bookdown 0.31 and GitBook 2.6.7" />

  <meta property="og:title" content="Tutorial 8: Threshold Autoregression | Educated Guess" />
  <meta property="og:type" content="book" />
  <meta property="og:image" content="/forecasting-logo.png" />
  <meta property="og:description" content="Forecasting With Time Series Models Using R" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Tutorial 8: Threshold Autoregression | Educated Guess" />
  
  <meta name="twitter:description" content="Forecasting With Time Series Models Using R" />
  <meta name="twitter:image" content="/forecasting-logo.png" />

<meta name="author" content="David Ubilava" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="tutorial-7-vector-autoregression.html"/>
<link rel="next" href="tutorial-9-comparing-forecasts.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="index.html#section" id="toc-section"></a></li>
<li class="chapter" data-level="" data-path="forecasting-with-time-series-models.html"><a href="forecasting-with-time-series-models.html"><i class="fa fa-check"></i>Forecasting With Time Series Models</a></li>
<li class="chapter" data-level="1" data-path="introduction-to-forecasting.html"><a href="introduction-to-forecasting.html"><i class="fa fa-check"></i><b>1</b> – Introduction to Forecasting</a>
<ul>
<li class="chapter" data-level="1.1" data-path="introduction-to-forecasting.html"><a href="introduction-to-forecasting.html#what-forecast-is-and-is-not"><i class="fa fa-check"></i><b>1.1</b> What Forecast Is and Is Not</a></li>
<li class="chapter" data-level="1.2" data-path="introduction-to-forecasting.html"><a href="introduction-to-forecasting.html#a-brief-history-of-the-study-of-forecasting"><i class="fa fa-check"></i><b>1.2</b> A Brief History of the Study of Forecasting</a></li>
<li class="chapter" data-level="1.3" data-path="introduction-to-forecasting.html"><a href="introduction-to-forecasting.html#through-the-lens-of-causal-inference"><i class="fa fa-check"></i><b>1.3</b> Through the Lens of Causal Inference</a></li>
<li class="chapter" data-level="1.4" data-path="introduction-to-forecasting.html"><a href="introduction-to-forecasting.html#self-fulfilling-prophecy"><i class="fa fa-check"></i><b>1.4</b> Self Fulfilling Prophecy</a></li>
<li class="chapter" data-level="1.5" data-path="introduction-to-forecasting.html"><a href="introduction-to-forecasting.html#knowing-the-unknown"><i class="fa fa-check"></i><b>1.5</b> Knowing the Unknown</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="features-of-time-series-data.html"><a href="features-of-time-series-data.html"><i class="fa fa-check"></i><b>2</b> – Features of Time Series Data</a>
<ul>
<li class="chapter" data-level="2.1" data-path="features-of-time-series-data.html"><a href="features-of-time-series-data.html#stochastic-process-and-time-series"><i class="fa fa-check"></i><b>2.1</b> Stochastic Process and Time Series</a></li>
<li class="chapter" data-level="2.2" data-path="features-of-time-series-data.html"><a href="features-of-time-series-data.html#stationarity"><i class="fa fa-check"></i><b>2.2</b> Stationarity</a></li>
<li class="chapter" data-level="2.3" data-path="features-of-time-series-data.html"><a href="features-of-time-series-data.html#serial-dependence"><i class="fa fa-check"></i><b>2.3</b> Serial Dependence</a></li>
<li class="chapter" data-level="2.4" data-path="features-of-time-series-data.html"><a href="features-of-time-series-data.html#transformations"><i class="fa fa-check"></i><b>2.4</b> Transformations</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="generating-and-evaluating-forecasts.html"><a href="generating-and-evaluating-forecasts.html"><i class="fa fa-check"></i><b>3</b> – Generating and Evaluating Forecasts</a>
<ul>
<li class="chapter" data-level="3.1" data-path="generating-and-evaluating-forecasts.html"><a href="generating-and-evaluating-forecasts.html#pseudo-forecasting-routine"><i class="fa fa-check"></i><b>3.1</b> Pseudo-Forecasting Routine</a></li>
<li class="chapter" data-level="3.2" data-path="generating-and-evaluating-forecasts.html"><a href="generating-and-evaluating-forecasts.html#forecast-assessment"><i class="fa fa-check"></i><b>3.2</b> Forecast Assessment</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="generating-and-evaluating-forecasts.html"><a href="generating-and-evaluating-forecasts.html#unbiasedness"><i class="fa fa-check"></i><b>3.2.1</b> Unbiasedness</a></li>
<li class="chapter" data-level="3.2.2" data-path="generating-and-evaluating-forecasts.html"><a href="generating-and-evaluating-forecasts.html#efficiency"><i class="fa fa-check"></i><b>3.2.2</b> Efficiency</a></li>
<li class="chapter" data-level="3.2.3" data-path="generating-and-evaluating-forecasts.html"><a href="generating-and-evaluating-forecasts.html#no-autocorrelation"><i class="fa fa-check"></i><b>3.2.3</b> No Autocorrelation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="trends.html"><a href="trends.html"><i class="fa fa-check"></i><b>4</b> – Trends</a>
<ul>
<li class="chapter" data-level="4.1" data-path="trends.html"><a href="trends.html#trends-in-the-data"><i class="fa fa-check"></i><b>4.1</b> Trends in the Data</a></li>
<li class="chapter" data-level="4.2" data-path="trends.html"><a href="trends.html#spurious-relationships"><i class="fa fa-check"></i><b>4.2</b> Spurious Relationships</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="trends.html"><a href="trends.html#deterministic-trends"><i class="fa fa-check"></i><b>4.2.1</b> Deterministic Trends</a></li>
<li class="chapter" data-level="4.2.2" data-path="trends.html"><a href="trends.html#stochastic-trends"><i class="fa fa-check"></i><b>4.2.2</b> Stochastic Trends</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="trends.html"><a href="trends.html#modeling"><i class="fa fa-check"></i><b>4.3</b> Modeling</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="trends.html"><a href="trends.html#trends-in-mortgage-rates"><i class="fa fa-check"></i><b>4.3.1</b> Trends in mortgage rates</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="trends.html"><a href="trends.html#forecasting"><i class="fa fa-check"></i><b>4.4</b> Forecasting</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="seasonality.html"><a href="seasonality.html"><i class="fa fa-check"></i><b>5</b> – Seasonality</a>
<ul>
<li class="chapter" data-level="5.1" data-path="seasonality.html"><a href="seasonality.html#seasonal-fluctuations-in-the-data"><i class="fa fa-check"></i><b>5.1</b> Seasonal Fluctuations in the Data</a></li>
<li class="chapter" data-level="5.2" data-path="seasonality.html"><a href="seasonality.html#modeling-1"><i class="fa fa-check"></i><b>5.2</b> Modeling</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="seasonality.html"><a href="seasonality.html#seasonal-dummy-variables"><i class="fa fa-check"></i><b>5.2.1</b> Seasonal dummy variables</a></li>
<li class="chapter" data-level="5.2.2" data-path="seasonality.html"><a href="seasonality.html#seasonal-harmonic-variables"><i class="fa fa-check"></i><b>5.2.2</b> Seasonal harmonic variables</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="seasonality.html"><a href="seasonality.html#forecasting-1"><i class="fa fa-check"></i><b>5.3</b> Forecasting</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="autoregression.html"><a href="autoregression.html"><i class="fa fa-check"></i><b>6</b> – Autoregression</a>
<ul>
<li class="chapter" data-level="6.1" data-path="autoregression.html"><a href="autoregression.html#stochastic-cycles"><i class="fa fa-check"></i><b>6.1</b> Stochastic Cycles</a></li>
<li class="chapter" data-level="6.2" data-path="autoregression.html"><a href="autoregression.html#modeling-2"><i class="fa fa-check"></i><b>6.2</b> Modeling</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="autoregression.html"><a href="autoregression.html#first-order-autoregression"><i class="fa fa-check"></i><b>6.2.1</b> First-order autoregression</a></li>
<li class="chapter" data-level="6.2.2" data-path="autoregression.html"><a href="autoregression.html#unit-roots-and-non-stationarity"><i class="fa fa-check"></i><b>6.2.2</b> Unit Roots and Non-stationarity</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="autoregression.html"><a href="autoregression.html#forecasting-2"><i class="fa fa-check"></i><b>6.3</b> Forecasting</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="autoregression.html"><a href="autoregression.html#iterative-method-of-multistep-forecasting"><i class="fa fa-check"></i><b>6.3.1</b> Iterative Method of Multistep Forecasting</a></li>
<li class="chapter" data-level="6.3.2" data-path="autoregression.html"><a href="autoregression.html#direct-method-of-multistep-forecasting"><i class="fa fa-check"></i><b>6.3.2</b> Direct Method of Multistep Forecasting</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="vector-autoregression.html"><a href="vector-autoregression.html"><i class="fa fa-check"></i><b>7</b> – Vector Autoregression</a>
<ul>
<li class="chapter" data-level="7.1" data-path="vector-autoregression.html"><a href="vector-autoregression.html#dynamic-feedbacks-among-economic-variables"><i class="fa fa-check"></i><b>7.1</b> Dynamic Feedbacks Among Economic Variables</a></li>
<li class="chapter" data-level="7.2" data-path="vector-autoregression.html"><a href="vector-autoregression.html#modeling-3"><i class="fa fa-check"></i><b>7.2</b> Modeling</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="vector-autoregression.html"><a href="vector-autoregression.html#in-sample-granger-causality"><i class="fa fa-check"></i><b>7.2.1</b> In-Sample Granger Causality</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="vector-autoregression.html"><a href="vector-autoregression.html#forecasting-3"><i class="fa fa-check"></i><b>7.3</b> Forecasting</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="vector-autoregression.html"><a href="vector-autoregression.html#one-step-ahead-forecasts"><i class="fa fa-check"></i><b>7.3.1</b> One-step-ahead forecasts</a></li>
<li class="chapter" data-level="7.3.2" data-path="vector-autoregression.html"><a href="vector-autoregression.html#multi-step-ahead-forecasts"><i class="fa fa-check"></i><b>7.3.2</b> Multi-step-ahead forecasts</a></li>
<li class="chapter" data-level="7.3.3" data-path="vector-autoregression.html"><a href="vector-autoregression.html#out-of-sample-granger-causality"><i class="fa fa-check"></i><b>7.3.3</b> Out-of-Sample Granger Causality</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="threshold-autoregression.html"><a href="threshold-autoregression.html"><i class="fa fa-check"></i><b>8</b> – Threshold Autoregression</a>
<ul>
<li class="chapter" data-level="8.1" data-path="threshold-autoregression.html"><a href="threshold-autoregression.html#regime-dependent-nonlinearity"><i class="fa fa-check"></i><b>8.1</b> Regime-Dependent Nonlinearity</a></li>
<li class="chapter" data-level="8.2" data-path="threshold-autoregression.html"><a href="threshold-autoregression.html#modeling-4"><i class="fa fa-check"></i><b>8.2</b> Modeling</a></li>
<li class="chapter" data-level="8.3" data-path="threshold-autoregression.html"><a href="threshold-autoregression.html#forecasting-4"><i class="fa fa-check"></i><b>8.3</b> Forecasting</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="threshold-autoregression.html"><a href="threshold-autoregression.html#skeleton-extrapolation"><i class="fa fa-check"></i><b>8.3.1</b> Skeleton Extrapolation</a></li>
<li class="chapter" data-level="8.3.2" data-path="threshold-autoregression.html"><a href="threshold-autoregression.html#analytical-method"><i class="fa fa-check"></i><b>8.3.2</b> Analytical Method</a></li>
<li class="chapter" data-level="8.3.3" data-path="threshold-autoregression.html"><a href="threshold-autoregression.html#numerical-method-bootstrap-resampling"><i class="fa fa-check"></i><b>8.3.3</b> Numerical Method: Bootstrap Resampling</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="comparing-forecasts.html"><a href="comparing-forecasts.html"><i class="fa fa-check"></i><b>9</b> – Comparing Forecasts</a>
<ul>
<li class="chapter" data-level="9.1" data-path="comparing-forecasts.html"><a href="comparing-forecasts.html#the-need-for-the-forecast-evaluation"><i class="fa fa-check"></i><b>9.1</b> The Need for the Forecast Evaluation</a></li>
<li class="chapter" data-level="9.2" data-path="comparing-forecasts.html"><a href="comparing-forecasts.html#relative-forecast-accuracy-tests"><i class="fa fa-check"></i><b>9.2</b> Relative Forecast Accuracy Tests</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="comparing-forecasts.html"><a href="comparing-forecasts.html#the-morgan-granger-newbold-test"><i class="fa fa-check"></i><b>9.2.1</b> The Morgan-Granger-Newbold Test</a></li>
<li class="chapter" data-level="9.2.2" data-path="comparing-forecasts.html"><a href="comparing-forecasts.html#the-diebold-mariano-test"><i class="fa fa-check"></i><b>9.2.2</b> The Diebold-Mariano Test</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="comparing-forecasts.html"><a href="comparing-forecasts.html#forecasting-year-on-year-monthly-inflation-12-steps-ahead"><i class="fa fa-check"></i><b>9.3</b> Forecasting Year-on-Year Monthly Inflation 12-steps-ahead</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="combining-forecasts.html"><a href="combining-forecasts.html"><i class="fa fa-check"></i><b>10</b> – Combining Forecasts</a>
<ul>
<li class="chapter" data-level="10.1" data-path="combining-forecasts.html"><a href="combining-forecasts.html#benefits-of-forecast-combination"><i class="fa fa-check"></i><b>10.1</b> Benefits of Forecast Combination</a></li>
<li class="chapter" data-level="10.2" data-path="combining-forecasts.html"><a href="combining-forecasts.html#optimal-weights-for-forecast-combination"><i class="fa fa-check"></i><b>10.2</b> Optimal Weights for Forecast Combination</a></li>
<li class="chapter" data-level="10.3" data-path="combining-forecasts.html"><a href="combining-forecasts.html#forecast-encompassing"><i class="fa fa-check"></i><b>10.3</b> Forecast Encompassing</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="forecasting-using-r.html"><a href="forecasting-using-r.html"><i class="fa fa-check"></i>Forecasting Using R</a></li>
<li class="chapter" data-level="" data-path="tutorial-1-introduction-to-r.html"><a href="tutorial-1-introduction-to-r.html"><i class="fa fa-check"></i>Tutorial 1: Introduction to R</a>
<ul>
<li class="chapter" data-level="" data-path="tutorial-1-introduction-to-r.html"><a href="tutorial-1-introduction-to-r.html#base-r-and-matrix-manipulations"><i class="fa fa-check"></i>Base R and matrix manipulations</a></li>
<li class="chapter" data-level="" data-path="tutorial-1-introduction-to-r.html"><a href="tutorial-1-introduction-to-r.html#estimating-parameters-using-ols"><i class="fa fa-check"></i>Estimating parameters using OLS</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="tutorial-2-data-management-and-visualisation.html"><a href="tutorial-2-data-management-and-visualisation.html"><i class="fa fa-check"></i>Tutorial 2: Data Management and Visualisation</a></li>
<li class="chapter" data-level="" data-path="tutorial-3-forecasting-methods-and-routines.html"><a href="tutorial-3-forecasting-methods-and-routines.html"><i class="fa fa-check"></i>Tutorial 3: Forecasting Methods and Routines</a></li>
<li class="chapter" data-level="" data-path="tutorial-4-trends.html"><a href="tutorial-4-trends.html"><i class="fa fa-check"></i>Tutorial 4: Trends</a></li>
<li class="chapter" data-level="" data-path="tutorial-5-seasonality.html"><a href="tutorial-5-seasonality.html"><i class="fa fa-check"></i>Tutorial 5: Seasonality</a></li>
<li class="chapter" data-level="" data-path="tutorial-6-autoregression.html"><a href="tutorial-6-autoregression.html"><i class="fa fa-check"></i>Tutorial 6: Autoregression</a></li>
<li class="chapter" data-level="" data-path="tutorial-7-vector-autoregression.html"><a href="tutorial-7-vector-autoregression.html"><i class="fa fa-check"></i>Tutorial 7: Vector Autoregression</a></li>
<li class="chapter" data-level="" data-path="tutorial-8-threshold-autoregression.html"><a href="tutorial-8-threshold-autoregression.html"><i class="fa fa-check"></i>Tutorial 8: Threshold Autoregression</a></li>
<li class="chapter" data-level="" data-path="tutorial-9-comparing-forecasts.html"><a href="tutorial-9-comparing-forecasts.html"><i class="fa fa-check"></i>Tutorial 9: Comparing Forecasts</a></li>
<li class="chapter" data-level="" data-path="tutorial-10-combining-forecasts.html"><a href="tutorial-10-combining-forecasts.html"><i class="fa fa-check"></i>Tutorial 10: Combining Forecasts</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Educated Guess</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="tutorial-8-threshold-autoregression" class="section level1 unnumbered hasAnchor">
<h1>Tutorial 8: Threshold Autoregression<a href="tutorial-8-threshold-autoregression.html#tutorial-8-threshold-autoregression" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>In this tutorial, we will generate regime-dependent series, we will apply a grid-search method to obtain the threshold parameter, we will obtain and compare one-step-ahead forecasts from competing models using a rolling window procedure, and we will apply bootstrap resampling method to generate multi-step-ahead forecasts from a threshold regression. To run the code, the <code>data.table</code> and <code>ggplot2</code> packages need to be installed and loaded.</p>
<p>Let’s generate a time series that follow a TAR(2) process of the following form:
<span class="math display">\[y_t = \left\{\begin{array}
{ll}
0.9y_{t-1} + \varepsilon_t &amp; \text{if}~~y_{t-1}\ge0 \\
1.2y_{t-1}-0.5y_{t-2} + \varepsilon_t &amp; \text{if}~~y_{t-1} &lt; 0
\end{array}\right.
\]</span>
where <span class="math inline">\(e_{t} \sim N(0,\sigma^2)\)</span>. This suggests that the dynamics of the time series change depending on the sign of the lagged dependent variable.</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="tutorial-8-threshold-autoregression.html#cb110-1" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">360</span></span>
<span id="cb110-2"><a href="tutorial-8-threshold-autoregression.html#cb110-2" tabindex="-1"></a></span>
<span id="cb110-3"><a href="tutorial-8-threshold-autoregression.html#cb110-3" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">8</span>)</span>
<span id="cb110-4"><a href="tutorial-8-threshold-autoregression.html#cb110-4" tabindex="-1"></a>e <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n,<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb110-5"><a href="tutorial-8-threshold-autoregression.html#cb110-5" tabindex="-1"></a></span>
<span id="cb110-6"><a href="tutorial-8-threshold-autoregression.html#cb110-6" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>,n)</span>
<span id="cb110-7"><a href="tutorial-8-threshold-autoregression.html#cb110-7" tabindex="-1"></a>y[<span class="dv">1</span>] <span class="ot">&lt;-</span> e[<span class="dv">1</span>]</span>
<span id="cb110-8"><a href="tutorial-8-threshold-autoregression.html#cb110-8" tabindex="-1"></a><span class="cf">if</span>(y[<span class="dv">1</span>]<span class="sc">&gt;=</span><span class="dv">0</span>){</span>
<span id="cb110-9"><a href="tutorial-8-threshold-autoregression.html#cb110-9" tabindex="-1"></a>  y[<span class="dv">2</span>] <span class="ot">&lt;-</span>  <span class="fl">0.9</span><span class="sc">*</span>y[<span class="dv">1</span>]<span class="sc">+</span>e[<span class="dv">2</span>]</span>
<span id="cb110-10"><a href="tutorial-8-threshold-autoregression.html#cb110-10" tabindex="-1"></a>}<span class="cf">else</span>{</span>
<span id="cb110-11"><a href="tutorial-8-threshold-autoregression.html#cb110-11" tabindex="-1"></a>  y[<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fl">1.2</span><span class="sc">*</span>y[<span class="dv">1</span>]<span class="sc">+</span>e[<span class="dv">2</span>]</span>
<span id="cb110-12"><a href="tutorial-8-threshold-autoregression.html#cb110-12" tabindex="-1"></a>}</span>
<span id="cb110-13"><a href="tutorial-8-threshold-autoregression.html#cb110-13" tabindex="-1"></a></span>
<span id="cb110-14"><a href="tutorial-8-threshold-autoregression.html#cb110-14" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">3</span><span class="sc">:</span>n){</span>
<span id="cb110-15"><a href="tutorial-8-threshold-autoregression.html#cb110-15" tabindex="-1"></a>  <span class="cf">if</span>(y[i<span class="dv">-1</span>]<span class="sc">&gt;=</span><span class="dv">0</span>){</span>
<span id="cb110-16"><a href="tutorial-8-threshold-autoregression.html#cb110-16" tabindex="-1"></a>    y[i] <span class="ot">&lt;-</span>  <span class="fl">0.9</span><span class="sc">*</span>y[i<span class="dv">-1</span>]<span class="sc">+</span>e[i]</span>
<span id="cb110-17"><a href="tutorial-8-threshold-autoregression.html#cb110-17" tabindex="-1"></a>  }<span class="cf">else</span>{</span>
<span id="cb110-18"><a href="tutorial-8-threshold-autoregression.html#cb110-18" tabindex="-1"></a>    y[i] <span class="ot">&lt;-</span> <span class="fl">1.2</span><span class="sc">*</span>y[i<span class="dv">-1</span>]<span class="sc">-</span><span class="fl">0.5</span><span class="sc">*</span>y[i<span class="dv">-2</span>]<span class="sc">+</span>e[i]</span>
<span id="cb110-19"><a href="tutorial-8-threshold-autoregression.html#cb110-19" tabindex="-1"></a>  }</span>
<span id="cb110-20"><a href="tutorial-8-threshold-autoregression.html#cb110-20" tabindex="-1"></a>}</span></code></pre></div>
<p>Generate a vector of some arbitrary dates (e.g., suppose we deal with the monthly series beginning from January 1991), and store these along with <span class="math inline">\(y\)</span> in a <strong>data.table</strong>, call it ‘dt’. Then plot the realized time series using <strong>ggplot</strong> function.</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="tutorial-8-threshold-autoregression.html#cb111-1" tabindex="-1"></a>date <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">as.Date</span>(<span class="st">&quot;1991-01-01&quot;</span>),<span class="at">by=</span><span class="st">&quot;month&quot;</span>,<span class="at">along.with=</span>y)</span>
<span id="cb111-2"><a href="tutorial-8-threshold-autoregression.html#cb111-2" tabindex="-1"></a></span>
<span id="cb111-3"><a href="tutorial-8-threshold-autoregression.html#cb111-3" tabindex="-1"></a>dt <span class="ot">&lt;-</span> <span class="fu">data.table</span>(date,y)</span>
<span id="cb111-4"><a href="tutorial-8-threshold-autoregression.html#cb111-4" tabindex="-1"></a></span>
<span id="cb111-5"><a href="tutorial-8-threshold-autoregression.html#cb111-5" tabindex="-1"></a><span class="fu">ggplot</span>(dt,<span class="fu">aes</span>(<span class="at">x=</span>date,<span class="at">y=</span>y))<span class="sc">+</span></span>
<span id="cb111-6"><a href="tutorial-8-threshold-autoregression.html#cb111-6" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size=</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb111-7"><a href="tutorial-8-threshold-autoregression.html#cb111-7" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">&quot;Year&quot;</span>,<span class="at">y=</span><span class="st">&quot;Series&quot;</span>)<span class="sc">+</span></span>
<span id="cb111-8"><a href="tutorial-8-threshold-autoregression.html#cb111-8" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="forecasting_files/figure-html/unnamed-chunk-76-1.png" width="600" /></p>
<p>Obtain the AIC and SIC for AR(p), <span class="math inline">\(p=1,\ldots,4\)</span>; decide on the optimal lag length based on AIC.</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="tutorial-8-threshold-autoregression.html#cb112-1" tabindex="-1"></a>dt[,<span class="st">`</span><span class="at">:=</span><span class="st">`</span>(<span class="at">y1=</span><span class="fu">shift</span>(y),<span class="at">y2=</span><span class="fu">shift</span>(y,<span class="dv">2</span>),<span class="at">y3=</span><span class="fu">shift</span>(y,<span class="dv">3</span>),<span class="at">y4=</span><span class="fu">shift</span>(y,<span class="dv">4</span>))]</span>
<span id="cb112-2"><a href="tutorial-8-threshold-autoregression.html#cb112-2" tabindex="-1"></a>dt <span class="ot">&lt;-</span> dt[<span class="fu">complete.cases</span>(dt)]</span>
<span id="cb112-3"><a href="tutorial-8-threshold-autoregression.html#cb112-3" tabindex="-1"></a></span>
<span id="cb112-4"><a href="tutorial-8-threshold-autoregression.html#cb112-4" tabindex="-1"></a>ic_dt <span class="ot">&lt;-</span> <span class="fu">data.table</span>(<span class="at">k=</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>),<span class="at">AIC=</span><span class="fu">as.numeric</span>(<span class="cn">NA</span>),<span class="at">SIC=</span><span class="fu">as.numeric</span>(<span class="cn">NA</span>))</span>
<span id="cb112-5"><a href="tutorial-8-threshold-autoregression.html#cb112-5" tabindex="-1"></a></span>
<span id="cb112-6"><a href="tutorial-8-threshold-autoregression.html#cb112-6" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(ic_dt)){</span>
<span id="cb112-7"><a href="tutorial-8-threshold-autoregression.html#cb112-7" tabindex="-1"></a>  </span>
<span id="cb112-8"><a href="tutorial-8-threshold-autoregression.html#cb112-8" tabindex="-1"></a>  fmla <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">paste</span>(<span class="st">&quot;y&quot;</span>,<span class="fu">paste0</span>(<span class="st">&quot;y&quot;</span>,<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span>i),<span class="at">collapse=</span><span class="st">&quot;+&quot;</span>),<span class="at">sep=</span><span class="st">&quot;~&quot;</span>))</span>
<span id="cb112-9"><a href="tutorial-8-threshold-autoregression.html#cb112-9" tabindex="-1"></a>  reg_ar <span class="ot">&lt;-</span> <span class="fu">lm</span>(fmla,<span class="at">data=</span>dt)</span>
<span id="cb112-10"><a href="tutorial-8-threshold-autoregression.html#cb112-10" tabindex="-1"></a>  </span>
<span id="cb112-11"><a href="tutorial-8-threshold-autoregression.html#cb112-11" tabindex="-1"></a>  ic_dt<span class="sc">$</span>AIC[i] <span class="ot">&lt;-</span> <span class="fu">log</span>(<span class="fu">crossprod</span>(reg_ar<span class="sc">$</span>residuals))<span class="sc">+</span><span class="dv">2</span><span class="sc">*</span>(i<span class="sc">+</span><span class="dv">1</span>)<span class="sc">/</span><span class="fu">nrow</span>(dt)</span>
<span id="cb112-12"><a href="tutorial-8-threshold-autoregression.html#cb112-12" tabindex="-1"></a>  ic_dt<span class="sc">$</span>SIC[i] <span class="ot">&lt;-</span> <span class="fu">log</span>(<span class="fu">crossprod</span>(reg_ar<span class="sc">$</span>residuals))<span class="sc">+</span><span class="fu">log</span>(<span class="fu">nrow</span>(dt))<span class="sc">*</span>(i<span class="sc">+</span><span class="dv">1</span>)<span class="sc">/</span><span class="fu">nrow</span>(dt)</span>
<span id="cb112-13"><a href="tutorial-8-threshold-autoregression.html#cb112-13" tabindex="-1"></a></span>
<span id="cb112-14"><a href="tutorial-8-threshold-autoregression.html#cb112-14" tabindex="-1"></a>}</span>
<span id="cb112-15"><a href="tutorial-8-threshold-autoregression.html#cb112-15" tabindex="-1"></a></span>
<span id="cb112-16"><a href="tutorial-8-threshold-autoregression.html#cb112-16" tabindex="-1"></a>ic_dt</span></code></pre></div>
<pre><code>##    k      AIC      SIC
## 1: 1 6.030794 6.052564
## 2: 2 5.987318 6.019972
## 3: 3 5.989787 6.033326
## 4: 4 5.994844 6.049268</code></pre>
<p>We now need to guess the threshold parameter (i.e., the value at which the switch between the regimes happens). For that, we perform a grid-search routine. We will consider a range of candidate thresholds that are within 10th and 90th percentiles of the lagged dependent variable. For each candidate threshold, we will run an OLS and calculate the residual sums of squares. A threshold parameter that yields the smallest residual sum of squares will be the estimate. Plot the residual sums of squares against the candidate threshold parameters to illustrate the optimal threshold selection routine.</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="tutorial-8-threshold-autoregression.html#cb114-1" tabindex="-1"></a>qy <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">quantile</span>(dt<span class="sc">$</span>y,<span class="fu">c</span>(.<span class="dv">1</span>,.<span class="dv">9</span>)),<span class="dv">1</span>)</span>
<span id="cb114-2"><a href="tutorial-8-threshold-autoregression.html#cb114-2" tabindex="-1"></a></span>
<span id="cb114-3"><a href="tutorial-8-threshold-autoregression.html#cb114-3" tabindex="-1"></a>tr <span class="ot">&lt;-</span> <span class="fu">seq</span>(qy[<span class="dv">1</span>],qy[<span class="dv">2</span>],<span class="at">by=</span>.<span class="dv">1</span>)</span>
<span id="cb114-4"><a href="tutorial-8-threshold-autoregression.html#cb114-4" tabindex="-1"></a></span>
<span id="cb114-5"><a href="tutorial-8-threshold-autoregression.html#cb114-5" tabindex="-1"></a>grid_dt <span class="ot">&lt;-</span> <span class="fu">data.table</span>(tr,<span class="at">ssr=</span><span class="cn">NA</span>)</span>
<span id="cb114-6"><a href="tutorial-8-threshold-autoregression.html#cb114-6" tabindex="-1"></a>grid_dt[,<span class="st">`</span><span class="at">:=</span><span class="st">`</span>(<span class="at">ssr=</span><span class="fu">as.numeric</span>(ssr))]</span>
<span id="cb114-7"><a href="tutorial-8-threshold-autoregression.html#cb114-7" tabindex="-1"></a></span>
<span id="cb114-8"><a href="tutorial-8-threshold-autoregression.html#cb114-8" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> tr){</span>
<span id="cb114-9"><a href="tutorial-8-threshold-autoregression.html#cb114-9" tabindex="-1"></a>  </span>
<span id="cb114-10"><a href="tutorial-8-threshold-autoregression.html#cb114-10" tabindex="-1"></a>  dt[,<span class="st">`</span><span class="at">:=</span><span class="st">`</span>(<span class="at">d=</span><span class="fu">ifelse</span>(y1<span class="sc">&gt;=</span>i,<span class="dv">1</span>,<span class="dv">0</span>))]</span>
<span id="cb114-11"><a href="tutorial-8-threshold-autoregression.html#cb114-11" tabindex="-1"></a>  </span>
<span id="cb114-12"><a href="tutorial-8-threshold-autoregression.html#cb114-12" tabindex="-1"></a>  tar <span class="ot">&lt;-</span> <span class="fu">lm</span>(y<span class="sc">~</span>(y1<span class="sc">+</span>y2)<span class="sc">:</span><span class="fu">I</span>(d)<span class="sc">+</span>(y1<span class="sc">+</span>y2)<span class="sc">:</span><span class="fu">I</span>(<span class="dv">1</span><span class="sc">-</span>d),<span class="at">data=</span>dt)</span>
<span id="cb114-13"><a href="tutorial-8-threshold-autoregression.html#cb114-13" tabindex="-1"></a>  </span>
<span id="cb114-14"><a href="tutorial-8-threshold-autoregression.html#cb114-14" tabindex="-1"></a>  grid_dt[tr<span class="sc">==</span>i]<span class="sc">$</span>ssr <span class="ot">&lt;-</span> <span class="fu">crossprod</span>(tar<span class="sc">$</span>residuals)</span>
<span id="cb114-15"><a href="tutorial-8-threshold-autoregression.html#cb114-15" tabindex="-1"></a>  </span>
<span id="cb114-16"><a href="tutorial-8-threshold-autoregression.html#cb114-16" tabindex="-1"></a>}</span>
<span id="cb114-17"><a href="tutorial-8-threshold-autoregression.html#cb114-17" tabindex="-1"></a></span>
<span id="cb114-18"><a href="tutorial-8-threshold-autoregression.html#cb114-18" tabindex="-1"></a>tr_hat <span class="ot">&lt;-</span> grid_dt[ssr<span class="sc">==</span><span class="fu">min</span>(ssr)]<span class="sc">$</span>tr</span>
<span id="cb114-19"><a href="tutorial-8-threshold-autoregression.html#cb114-19" tabindex="-1"></a>tr_hat</span></code></pre></div>
<pre><code>## [1] -0.1</code></pre>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="tutorial-8-threshold-autoregression.html#cb116-1" tabindex="-1"></a><span class="fu">ggplot</span>(grid_dt,<span class="fu">aes</span>(<span class="at">x=</span>tr,<span class="at">y=</span>ssr))<span class="sc">+</span></span>
<span id="cb116-2"><a href="tutorial-8-threshold-autoregression.html#cb116-2" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size=</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb116-3"><a href="tutorial-8-threshold-autoregression.html#cb116-3" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept=</span>tr_hat,<span class="at">color=</span><span class="st">&quot;coral&quot;</span>,<span class="at">linetype=</span><span class="dv">5</span>)<span class="sc">+</span></span>
<span id="cb116-4"><a href="tutorial-8-threshold-autoregression.html#cb116-4" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">&quot;Threshold&quot;</span>,<span class="at">y=</span><span class="st">&quot;RSS&quot;</span>)<span class="sc">+</span></span>
<span id="cb116-5"><a href="tutorial-8-threshold-autoregression.html#cb116-5" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="forecasting_files/figure-html/unnamed-chunk-78-1.png" width="600" /></p>
<p>Estimate the threshold autoregression and compare the parameter estimates with the true parameters of the model.</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="tutorial-8-threshold-autoregression.html#cb117-1" tabindex="-1"></a>dt[,<span class="st">`</span><span class="at">:=</span><span class="st">`</span>(<span class="at">d=</span><span class="fu">ifelse</span>(y1<span class="sc">&gt;=</span>tr_hat,<span class="dv">1</span>,<span class="dv">0</span>))]</span>
<span id="cb117-2"><a href="tutorial-8-threshold-autoregression.html#cb117-2" tabindex="-1"></a></span>
<span id="cb117-3"><a href="tutorial-8-threshold-autoregression.html#cb117-3" tabindex="-1"></a>tar <span class="ot">&lt;-</span> <span class="fu">lm</span>(y<span class="sc">~</span>(y1<span class="sc">+</span>y2)<span class="sc">:</span><span class="fu">I</span>(d)<span class="sc">+</span>(y1<span class="sc">+</span>y2)<span class="sc">:</span><span class="fu">I</span>(<span class="dv">1</span><span class="sc">-</span>d),<span class="at">data=</span>dt)</span>
<span id="cb117-4"><a href="tutorial-8-threshold-autoregression.html#cb117-4" tabindex="-1"></a><span class="fu">summary</span>(tar)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = y ~ (y1 + y2):I(d) + (y1 + y2):I(1 - d), data = dt)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -3.07702 -0.69964  0.01969  0.65595  2.47130 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  0.01150    0.08554   0.134    0.893    
## y1:I(d)      0.70886    0.08895   7.969 2.26e-14 ***
## y2:I(d)      0.06424    0.07576   0.848    0.397    
## y1:I(1 - d)  1.15232    0.07632  15.099  &lt; 2e-16 ***
## y2:I(1 - d) -0.45200    0.06818  -6.630 1.27e-10 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 1.02 on 351 degrees of freedom
## Multiple R-squared:  0.6447, Adjusted R-squared:  0.6407 
## F-statistic: 159.3 on 4 and 351 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>Generate a sequence of one-step-ahead forecasts from TAR(2) using the rolling window scheme, where the first rolling window ranges from period 1 to period 240. For comparison, also generate the one-step-ahead forecasts from the AR(2) and the random walk models. Calculate the RMSFE measures for the three models.</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="tutorial-8-threshold-autoregression.html#cb119-1" tabindex="-1"></a>R <span class="ot">&lt;-</span> <span class="dv">240</span></span>
<span id="cb119-2"><a href="tutorial-8-threshold-autoregression.html#cb119-2" tabindex="-1"></a>P <span class="ot">&lt;-</span> <span class="fu">nrow</span>(dt)<span class="sc">-</span>R</span>
<span id="cb119-3"><a href="tutorial-8-threshold-autoregression.html#cb119-3" tabindex="-1"></a></span>
<span id="cb119-4"><a href="tutorial-8-threshold-autoregression.html#cb119-4" tabindex="-1"></a>dt[,<span class="st">`</span><span class="at">:=</span><span class="st">`</span>(<span class="at">rw=</span><span class="fu">as.numeric</span>(<span class="cn">NA</span>),<span class="at">ar=</span><span class="fu">as.numeric</span>(<span class="cn">NA</span>),<span class="at">tar=</span><span class="fu">as.numeric</span>(<span class="cn">NA</span>))]</span>
<span id="cb119-5"><a href="tutorial-8-threshold-autoregression.html#cb119-5" tabindex="-1"></a></span>
<span id="cb119-6"><a href="tutorial-8-threshold-autoregression.html#cb119-6" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>P){</span>
<span id="cb119-7"><a href="tutorial-8-threshold-autoregression.html#cb119-7" tabindex="-1"></a>  </span>
<span id="cb119-8"><a href="tutorial-8-threshold-autoregression.html#cb119-8" tabindex="-1"></a>  ar <span class="ot">&lt;-</span> <span class="fu">lm</span>(y<span class="sc">~</span>y1<span class="sc">+</span>y2,<span class="at">data=</span>dt[i<span class="sc">:</span>(R<span class="dv">-1</span><span class="sc">+</span>i)])</span>
<span id="cb119-9"><a href="tutorial-8-threshold-autoregression.html#cb119-9" tabindex="-1"></a>  </span>
<span id="cb119-10"><a href="tutorial-8-threshold-autoregression.html#cb119-10" tabindex="-1"></a>  tar <span class="ot">&lt;-</span> <span class="fu">lm</span>(y<span class="sc">~</span>(y1<span class="sc">+</span>y2)<span class="sc">:</span><span class="fu">I</span>(d)<span class="sc">+</span>(y1<span class="sc">+</span>y2)<span class="sc">:</span><span class="fu">I</span>(<span class="dv">1</span><span class="sc">-</span>d),<span class="at">data=</span>dt[i<span class="sc">:</span>(R<span class="dv">-1</span><span class="sc">+</span>i)])</span>
<span id="cb119-11"><a href="tutorial-8-threshold-autoregression.html#cb119-11" tabindex="-1"></a>  </span>
<span id="cb119-12"><a href="tutorial-8-threshold-autoregression.html#cb119-12" tabindex="-1"></a>  dt<span class="sc">$</span>rw[R<span class="sc">+</span>i] <span class="ot">&lt;-</span> dt<span class="sc">$</span>y[R<span class="dv">-1</span><span class="sc">+</span>i]</span>
<span id="cb119-13"><a href="tutorial-8-threshold-autoregression.html#cb119-13" tabindex="-1"></a>  </span>
<span id="cb119-14"><a href="tutorial-8-threshold-autoregression.html#cb119-14" tabindex="-1"></a>  dt<span class="sc">$</span>ar[R<span class="sc">+</span>i] <span class="ot">&lt;-</span> ar<span class="sc">$</span>coefficients[<span class="dv">1</span>]<span class="sc">+</span>ar<span class="sc">$</span>coefficients[<span class="dv">2</span>]<span class="sc">*</span>dt<span class="sc">$</span>y[R<span class="dv">-1</span><span class="sc">+</span>i]<span class="sc">+</span>ar<span class="sc">$</span>coefficients[<span class="dv">3</span>]<span class="sc">*</span>dt<span class="sc">$</span>y[R<span class="dv">-2</span><span class="sc">+</span>i]</span>
<span id="cb119-15"><a href="tutorial-8-threshold-autoregression.html#cb119-15" tabindex="-1"></a>  </span>
<span id="cb119-16"><a href="tutorial-8-threshold-autoregression.html#cb119-16" tabindex="-1"></a>  <span class="cf">if</span>(dt<span class="sc">$</span>y[R<span class="dv">-1</span><span class="sc">+</span>i]<span class="sc">&gt;=</span><span class="dv">0</span>){</span>
<span id="cb119-17"><a href="tutorial-8-threshold-autoregression.html#cb119-17" tabindex="-1"></a>    dt<span class="sc">$</span>tar[R<span class="sc">+</span>i] <span class="ot">&lt;-</span> tar<span class="sc">$</span>coefficients[<span class="dv">1</span>]<span class="sc">+</span>tar<span class="sc">$</span>coefficients[<span class="dv">2</span>]<span class="sc">*</span>dt<span class="sc">$</span>y[R<span class="dv">-1</span><span class="sc">+</span>i]<span class="sc">+</span>tar<span class="sc">$</span>coefficients[<span class="dv">3</span>]<span class="sc">*</span>dt<span class="sc">$</span>y[R<span class="dv">-2</span><span class="sc">+</span>i]</span>
<span id="cb119-18"><a href="tutorial-8-threshold-autoregression.html#cb119-18" tabindex="-1"></a>  }<span class="cf">else</span>{</span>
<span id="cb119-19"><a href="tutorial-8-threshold-autoregression.html#cb119-19" tabindex="-1"></a>    dt<span class="sc">$</span>tar[R<span class="sc">+</span>i] <span class="ot">&lt;-</span> tar<span class="sc">$</span>coefficients[<span class="dv">1</span>]<span class="sc">+</span>tar<span class="sc">$</span>coefficients[<span class="dv">4</span>]<span class="sc">*</span>dt<span class="sc">$</span>y[R<span class="dv">-1</span><span class="sc">+</span>i]<span class="sc">+</span>tar<span class="sc">$</span>coefficients[<span class="dv">5</span>]<span class="sc">*</span>dt<span class="sc">$</span>y[R<span class="dv">-2</span><span class="sc">+</span>i]</span>
<span id="cb119-20"><a href="tutorial-8-threshold-autoregression.html#cb119-20" tabindex="-1"></a>  }</span>
<span id="cb119-21"><a href="tutorial-8-threshold-autoregression.html#cb119-21" tabindex="-1"></a>  </span>
<span id="cb119-22"><a href="tutorial-8-threshold-autoregression.html#cb119-22" tabindex="-1"></a>}</span>
<span id="cb119-23"><a href="tutorial-8-threshold-autoregression.html#cb119-23" tabindex="-1"></a></span>
<span id="cb119-24"><a href="tutorial-8-threshold-autoregression.html#cb119-24" tabindex="-1"></a>dt[,<span class="st">`</span><span class="at">:=</span><span class="st">`</span>(<span class="at">rw_e=</span>y<span class="sc">-</span>rw,<span class="at">ar_e=</span>y<span class="sc">-</span>ar,<span class="at">tar_e=</span>y<span class="sc">-</span>tar)]</span>
<span id="cb119-25"><a href="tutorial-8-threshold-autoregression.html#cb119-25" tabindex="-1"></a></span>
<span id="cb119-26"><a href="tutorial-8-threshold-autoregression.html#cb119-26" tabindex="-1"></a>rmsfe_rw <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>(dt<span class="sc">$</span>rw_e<span class="sc">^</span><span class="dv">2</span>,<span class="at">na.rm=</span>T))</span>
<span id="cb119-27"><a href="tutorial-8-threshold-autoregression.html#cb119-27" tabindex="-1"></a>rmsfe_ar <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>(dt<span class="sc">$</span>ar_e<span class="sc">^</span><span class="dv">2</span>,<span class="at">na.rm=</span>T))</span>
<span id="cb119-28"><a href="tutorial-8-threshold-autoregression.html#cb119-28" tabindex="-1"></a>rmsfe_tar <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>(dt<span class="sc">$</span>tar_e<span class="sc">^</span><span class="dv">2</span>,<span class="at">na.rm=</span>T))</span>
<span id="cb119-29"><a href="tutorial-8-threshold-autoregression.html#cb119-29" tabindex="-1"></a></span>
<span id="cb119-30"><a href="tutorial-8-threshold-autoregression.html#cb119-30" tabindex="-1"></a>rmsfe_rw</span></code></pre></div>
<pre><code>## [1] 1.091629</code></pre>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="tutorial-8-threshold-autoregression.html#cb121-1" tabindex="-1"></a>rmsfe_ar</span></code></pre></div>
<pre><code>## [1] 1.046419</code></pre>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="tutorial-8-threshold-autoregression.html#cb123-1" tabindex="-1"></a>rmsfe_tar</span></code></pre></div>
<pre><code>## [1] 1.024177</code></pre>
<p>Obtain the multi-step-ahead forecasts from period 241 onward using the so-called ‘skeleton extrapolation’ method (which yields biased forecasts) and the bootstrap resampling method (a numerical method that yields valid multi-step-ahead forecasts from nonlinear models). Plot the two forecasts along with the time series.</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="tutorial-8-threshold-autoregression.html#cb125-1" tabindex="-1"></a>dt[,<span class="st">`</span><span class="at">:=</span><span class="st">`</span>(<span class="at">tar_skeleton=</span>y)]</span>
<span id="cb125-2"><a href="tutorial-8-threshold-autoregression.html#cb125-2" tabindex="-1"></a></span>
<span id="cb125-3"><a href="tutorial-8-threshold-autoregression.html#cb125-3" tabindex="-1"></a>tar <span class="ot">&lt;-</span> <span class="fu">lm</span>(y<span class="sc">~</span>(y1<span class="sc">+</span>y2)<span class="sc">:</span><span class="fu">I</span>(d)<span class="sc">+</span>(y1<span class="sc">+</span>y2)<span class="sc">:</span><span class="fu">I</span>(<span class="dv">1</span><span class="sc">-</span>d),<span class="at">data=</span>dt[<span class="dv">1</span><span class="sc">:</span>R])</span>
<span id="cb125-4"><a href="tutorial-8-threshold-autoregression.html#cb125-4" tabindex="-1"></a></span>
<span id="cb125-5"><a href="tutorial-8-threshold-autoregression.html#cb125-5" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>P){</span>
<span id="cb125-6"><a href="tutorial-8-threshold-autoregression.html#cb125-6" tabindex="-1"></a>  </span>
<span id="cb125-7"><a href="tutorial-8-threshold-autoregression.html#cb125-7" tabindex="-1"></a>  <span class="cf">if</span>(dt<span class="sc">$</span>tar_skeleton[R<span class="dv">-1</span><span class="sc">+</span>i]<span class="sc">&gt;=</span><span class="dv">0</span>){</span>
<span id="cb125-8"><a href="tutorial-8-threshold-autoregression.html#cb125-8" tabindex="-1"></a>    dt<span class="sc">$</span>tar_skeleton[R<span class="sc">+</span>i] <span class="ot">&lt;-</span> tar<span class="sc">$</span>coefficients[<span class="dv">1</span>]<span class="sc">+</span>tar<span class="sc">$</span>coefficients[<span class="dv">2</span>]<span class="sc">*</span>dt<span class="sc">$</span>tar_skeleton[R<span class="dv">-1</span><span class="sc">+</span>i]<span class="sc">+</span>tar<span class="sc">$</span>coefficients[<span class="dv">3</span>]<span class="sc">*</span>dt<span class="sc">$</span>tar_skeleton[R<span class="dv">-2</span><span class="sc">+</span>i]</span>
<span id="cb125-9"><a href="tutorial-8-threshold-autoregression.html#cb125-9" tabindex="-1"></a>  }<span class="cf">else</span>{</span>
<span id="cb125-10"><a href="tutorial-8-threshold-autoregression.html#cb125-10" tabindex="-1"></a>    dt<span class="sc">$</span>tar_skeleton[R<span class="sc">+</span>i] <span class="ot">&lt;-</span> tar<span class="sc">$</span>coefficients[<span class="dv">1</span>]<span class="sc">+</span>tar<span class="sc">$</span>coefficients[<span class="dv">4</span>]<span class="sc">*</span>dt<span class="sc">$</span>tar_skeleton[R<span class="dv">-1</span><span class="sc">+</span>i]<span class="sc">+</span>tar<span class="sc">$</span>coefficients[<span class="dv">5</span>]<span class="sc">*</span>dt<span class="sc">$</span>tar_skeleton[R<span class="dv">-2</span><span class="sc">+</span>i]</span>
<span id="cb125-11"><a href="tutorial-8-threshold-autoregression.html#cb125-11" tabindex="-1"></a>  }</span>
<span id="cb125-12"><a href="tutorial-8-threshold-autoregression.html#cb125-12" tabindex="-1"></a>  </span>
<span id="cb125-13"><a href="tutorial-8-threshold-autoregression.html#cb125-13" tabindex="-1"></a>}</span>
<span id="cb125-14"><a href="tutorial-8-threshold-autoregression.html#cb125-14" tabindex="-1"></a></span>
<span id="cb125-15"><a href="tutorial-8-threshold-autoregression.html#cb125-15" tabindex="-1"></a>dt[<span class="dv">1</span><span class="sc">:</span>R]<span class="sc">$</span>tar_skeleton <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb125-16"><a href="tutorial-8-threshold-autoregression.html#cb125-16" tabindex="-1"></a></span>
<span id="cb125-17"><a href="tutorial-8-threshold-autoregression.html#cb125-17" tabindex="-1"></a></span>
<span id="cb125-18"><a href="tutorial-8-threshold-autoregression.html#cb125-18" tabindex="-1"></a>B <span class="ot">&lt;-</span> <span class="dv">5000</span> <span class="co"># the number of bootstrap simulations</span></span>
<span id="cb125-19"><a href="tutorial-8-threshold-autoregression.html#cb125-19" tabindex="-1"></a></span>
<span id="cb125-20"><a href="tutorial-8-threshold-autoregression.html#cb125-20" tabindex="-1"></a>boot_mat <span class="ot">&lt;-</span> <span class="fu">replicate</span>(B,dt<span class="sc">$</span>y)</span>
<span id="cb125-21"><a href="tutorial-8-threshold-autoregression.html#cb125-21" tabindex="-1"></a></span>
<span id="cb125-22"><a href="tutorial-8-threshold-autoregression.html#cb125-22" tabindex="-1"></a><span class="cf">for</span>(b <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>B){</span>
<span id="cb125-23"><a href="tutorial-8-threshold-autoregression.html#cb125-23" tabindex="-1"></a>  eps <span class="ot">&lt;-</span> <span class="fu">sample</span>(tar<span class="sc">$</span>residuals,P,<span class="at">replace=</span>T)</span>
<span id="cb125-24"><a href="tutorial-8-threshold-autoregression.html#cb125-24" tabindex="-1"></a>  </span>
<span id="cb125-25"><a href="tutorial-8-threshold-autoregression.html#cb125-25" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>P){</span>
<span id="cb125-26"><a href="tutorial-8-threshold-autoregression.html#cb125-26" tabindex="-1"></a>    </span>
<span id="cb125-27"><a href="tutorial-8-threshold-autoregression.html#cb125-27" tabindex="-1"></a>    <span class="cf">if</span>(boot_mat[R<span class="dv">-1</span><span class="sc">+</span>i,b]<span class="sc">&gt;=</span><span class="dv">0</span>){</span>
<span id="cb125-28"><a href="tutorial-8-threshold-autoregression.html#cb125-28" tabindex="-1"></a>      boot_mat[R<span class="sc">+</span>i,b] <span class="ot">&lt;-</span> tar<span class="sc">$</span>coefficients[<span class="dv">1</span>]<span class="sc">+</span>tar<span class="sc">$</span>coefficients[<span class="dv">2</span>]<span class="sc">*</span>boot_mat[R<span class="dv">-1</span><span class="sc">+</span>i,b]<span class="sc">+</span>tar<span class="sc">$</span>coefficients[<span class="dv">3</span>]<span class="sc">*</span>boot_mat[R<span class="dv">-2</span><span class="sc">+</span>i,b]<span class="sc">+</span>eps[i]</span>
<span id="cb125-29"><a href="tutorial-8-threshold-autoregression.html#cb125-29" tabindex="-1"></a>    }<span class="cf">else</span>{</span>
<span id="cb125-30"><a href="tutorial-8-threshold-autoregression.html#cb125-30" tabindex="-1"></a>      boot_mat[R<span class="sc">+</span>i,b] <span class="ot">&lt;-</span> tar<span class="sc">$</span>coefficients[<span class="dv">1</span>]<span class="sc">+</span>tar<span class="sc">$</span>coefficients[<span class="dv">4</span>]<span class="sc">*</span>boot_mat[R<span class="dv">-1</span><span class="sc">+</span>i,b]<span class="sc">+</span>tar<span class="sc">$</span>coefficients[<span class="dv">5</span>]<span class="sc">*</span>boot_mat[R<span class="dv">-2</span><span class="sc">+</span>i,b]<span class="sc">+</span>eps[i]</span>
<span id="cb125-31"><a href="tutorial-8-threshold-autoregression.html#cb125-31" tabindex="-1"></a>    }</span>
<span id="cb125-32"><a href="tutorial-8-threshold-autoregression.html#cb125-32" tabindex="-1"></a>    </span>
<span id="cb125-33"><a href="tutorial-8-threshold-autoregression.html#cb125-33" tabindex="-1"></a>  }</span>
<span id="cb125-34"><a href="tutorial-8-threshold-autoregression.html#cb125-34" tabindex="-1"></a>  </span>
<span id="cb125-35"><a href="tutorial-8-threshold-autoregression.html#cb125-35" tabindex="-1"></a>}</span>
<span id="cb125-36"><a href="tutorial-8-threshold-autoregression.html#cb125-36" tabindex="-1"></a></span>
<span id="cb125-37"><a href="tutorial-8-threshold-autoregression.html#cb125-37" tabindex="-1"></a>dt<span class="sc">$</span>tar_boot <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(boot_mat)</span>
<span id="cb125-38"><a href="tutorial-8-threshold-autoregression.html#cb125-38" tabindex="-1"></a>dt[<span class="dv">1</span><span class="sc">:</span>R]<span class="sc">$</span>tar_boot <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb125-39"><a href="tutorial-8-threshold-autoregression.html#cb125-39" tabindex="-1"></a></span>
<span id="cb125-40"><a href="tutorial-8-threshold-autoregression.html#cb125-40" tabindex="-1"></a>sub_lg <span class="ot">&lt;-</span> <span class="fu">melt</span>(dt[,.(date,y,tar_skeleton,tar_boot)],<span class="at">id.vars=</span><span class="st">&quot;date&quot;</span>)</span>
<span id="cb125-41"><a href="tutorial-8-threshold-autoregression.html#cb125-41" tabindex="-1"></a></span>
<span id="cb125-42"><a href="tutorial-8-threshold-autoregression.html#cb125-42" tabindex="-1"></a><span class="fu">ggplot</span>(sub_lg,<span class="fu">aes</span>(<span class="at">x=</span>date,<span class="at">y=</span>value,<span class="at">color=</span>variable,<span class="at">linetype=</span>variable))<span class="sc">+</span></span>
<span id="cb125-43"><a href="tutorial-8-threshold-autoregression.html#cb125-43" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size=</span><span class="dv">1</span>,<span class="at">na.rm=</span>T)<span class="sc">+</span></span>
<span id="cb125-44"><a href="tutorial-8-threshold-autoregression.html#cb125-44" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">&quot;darkgray&quot;</span>,<span class="st">&quot;coral&quot;</span>,<span class="st">&quot;steelblue&quot;</span>))<span class="sc">+</span></span>
<span id="cb125-45"><a href="tutorial-8-threshold-autoregression.html#cb125-45" tabindex="-1"></a>  <span class="fu">scale_linetype_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">5</span>))<span class="sc">+</span></span>
<span id="cb125-46"><a href="tutorial-8-threshold-autoregression.html#cb125-46" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">&quot;Year&quot;</span>,<span class="at">y=</span><span class="st">&quot;Series&quot;</span>)<span class="sc">+</span></span>
<span id="cb125-47"><a href="tutorial-8-threshold-autoregression.html#cb125-47" tabindex="-1"></a>  <span class="fu">theme_classic</span>()<span class="sc">+</span></span>
<span id="cb125-48"><a href="tutorial-8-threshold-autoregression.html#cb125-48" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">&quot;top&quot;</span>,<span class="at">legend.title=</span><span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="forecasting_files/figure-html/unnamed-chunk-81-1.png" width="600" /></p>

</div>
            </section>

          </div>
        </div>
      </div>
<a href="tutorial-7-vector-autoregression.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="tutorial-9-comparing-forecasts.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
