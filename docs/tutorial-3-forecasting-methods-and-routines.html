<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="Tutorial 3: Forecasting Methods and Routines | Forecasting With Time Series Models Using R" />
<meta property="og:type" content="book" />
<meta property="og:image" content="/forecasting-logo.png" />
<meta property="og:description" content="Tutorial 3: Forecasting Methods and Routines | Forecasting With Time Series Models Using R" />


<meta name="author" content="David Ubilava" />


<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<meta name="description" content="Tutorial 3: Forecasting Methods and Routines | Forecasting With Time Series Models Using R">

<title>Tutorial 3: Forecasting Methods and Routines | Forecasting With Time Series Models Using R</title>

<link href="libs/tufte-css-2015.12.29/tufte.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/envisioned.css" rel="stylesheet" />
<link href="libs/msmb-css-0/msmb.css" rel="stylesheet" />
<script>
function toggle_visibility(id1, id2) {
var e = document.getElementById(id1);
var f = document.getElementById(id2);

e.style.display = ((e.style.display!='none') ? 'none' : 'block');

if(f.classList.contains('fa-plus-square')) {
    f.classList.add('fa-minus-square')
    f.classList.remove('fa-plus-square')
} else {
    f.classList.add('fa-plus-square')
    f.classList.remove('fa-minus-square')
}

}
</script>
<script>
function copy_link(id) {
  var dummy = document.createElement('input'),
  text = window.location.href.split(/[?#]/)[0] + '#' + id;
  document.body.appendChild(dummy);
  dummy.value = text;
  dummy.select();
  document.execCommand('copy');
  document.body.removeChild(dummy);
  
  var tooltip = document.getElementById(id + '-tooltip');
  tooltip.innerHTML = 'Copied!';
}

function reset_tooltip(id) {
  var tooltip = document.getElementById(id);
  tooltip.innerHTML = 'Copy link';
}
</script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
<script>
  $(document).ready(function () {
    var element_label= $("label[for *= 'tufte-sn-']");
    var count = $(element_label).length;
    $(element_label).each(function( index ) {
      //console.log( ++index + ": " + $( this ).text() );
      $(this).attr('for','tufte-sn-'+ ++index);
      $(this).text(index);
    });
  });
  $(document).ready(function () {
    var element_input= $("input[id *= 'tufte-sn-']");
    var count = $(element_input).length;
    $(element_input).each(function( index ) {
      //console.log( ++index + ": " + $( this ).text() );
      $(this).attr('id','tufte-sn-'+ ++index);
    }); 
  });
  $(document).ready(function () {
    var element_span= $("span[class *= 'sidenote-number']");
    var count = $(element_span).length;
    $(element_span).each(function( index ) {
      //console.log( ++index + ": " + $( this ).text() );
      $(this).text(++index);
    }); 
  });
</script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }

code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />

</head>

<body>



<div class="row">
<div class="col-sm-12">
<div id="TOC">
<ul class="navbar">
<li class="msmb"><p class="title">Forecasting With Time Series Models Using R<p><p class="author">David Ubilava</p>
<li class="dropdown" style="float:right">
<a href="javascript:void(0)" class="dropbtn">&#x25BE; Chapters</a>
<div class="dropdown-content">
<a href="index.html" id="toc-foreword">Foreword</a>
<a href="forecasting-with-time-series-models.html" id="toc-forecasting-with-time-series-models">Forecasting With Time Series Models</a>
<a href="introduction-to-forecasting.html" id="toc-introduction-to-forecasting"><span class="toc-section-number">1</span> Introduction to Forecasting</a>
<a href="features-of-time-series-data.html" id="toc-features-of-time-series-data"><span class="toc-section-number">2</span> Features of Time Series Data</a>
<a href="forecasting-methods-and-routines.html" id="toc-forecasting-methods-and-routines"><span class="toc-section-number">3</span> Forecasting Methods and Routines</a>
<a href="trends.html" id="toc-trends"><span class="toc-section-number">4</span> Trends</a>
<a href="seasonality.html" id="toc-seasonality"><span class="toc-section-number">5</span> Seasonality</a>
<a href="autoregressive-models.html" id="toc-autoregressive-models"><span class="toc-section-number">6</span> Autoregressive Models</a>
<a href="vector-autoregressive-models.html" id="toc-vector-autoregressive-models"><span class="toc-section-number">7</span> Vector Autoregressive Models</a>
<a href="dynamic-factor-models.html" id="toc-dynamic-factor-models"><span class="toc-section-number">8</span> Dynamic Factor Models</a>
<a href="threshold-autoregressive-models.html" id="toc-threshold-autoregressive-models"><span class="toc-section-number">9</span> Threshold Autoregressive Models</a>
<a href="forecast-evaluation.html" id="toc-forecast-evaluation"><span class="toc-section-number">10</span> Forecast Evaluation</a>
<a href="forecast-combination.html" id="toc-forecast-combination"><span class="toc-section-number">11</span> Forecast Combination</a>
<a href="forecasting-using-r.html" id="toc-forecasting-using-r">Forecasting Using R</a>
<a href="tutorial-1-introduction-to-r.html" id="toc-tutorial-1-introduction-to-r">Tutorial 1: Introduction to R</a>
<a href="tutorial-2-data-management-and-visualisation.html" id="toc-tutorial-2-data-management-and-visualisation">Tutorial 2: Data Management and Visualisation</a>
<a id="active-page" href="tutorial-3-forecasting-methods-and-routines.html" id="toc-tutorial-3-forecasting-methods-and-routines">Tutorial 3: Forecasting Methods and Routines</a>
<a href="tutorial-4-trends-and-seasonality.html" id="toc-tutorial-4-trends-and-seasonality">Tutorial 4: Trends and Seasonality</a>
<a href="tutorial-5-autoregressive-models.html" id="toc-tutorial-5-autoregressive-models">Tutorial 5: Autoregressive Models</a>
<a href="tutorial-6-vector-autoregressive-models.html" id="toc-tutorial-6-vector-autoregressive-models">Tutorial 6: Vector Autoregressive Models</a>
<a href="tutorial-7-dynamic-factor-models.html" id="toc-tutorial-7-dynamic-factor-models">Tutorial 7: Dynamic Factor Models</a>
<a href="tutorial-8-threshold-autoregression.html" id="toc-tutorial-8-threshold-autoregression">Tutorial 8: Threshold Autoregression</a>
<a href="tutorial-9-forecast-evaluation.html" id="toc-tutorial-9-forecast-evaluation">Tutorial 9: Forecast Evaluation</a>
<a href="tutorial-10-forecast-combination.html" id="toc-tutorial-10-forecast-combination">Tutorial 10: Forecast Combination</a>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="row">
<div class="col-sm-12">
<div id="tutorial-3-forecasting-methods-and-routines" class="section level1 unnumbered">
<h1>Tutorial 3: Forecasting Methods and Routines</h1>
<p>In this tutorial, we will introduce ‘for loop’, and illustrate its use by generating time series as well as by generating one-step-ahead forecasts. We will also perform forecast error diagnostics. To run the code, the <code>data.table</code> and <code>ggplot2</code> packages need to be installed and loaded.</p>
<p>Let’s generate a random walk process, such that <span class="math inline">\(y_{t} = y_{t-1}+e_{t}\)</span>, where <span class="math inline">\(e_{t} \sim N(0,1)\)</span>, and where <span class="math inline">\(y_{0}=0\)</span>, for <span class="math inline">\(t=1,\ldots,120\)</span>.<label for="tufte-sn-10" class="margin-toggle sidenote-number">10</label><input type="checkbox" id="tufte-sn-10" class="margin-toggle"><span class="sidenote"><span class="sidenote-number">10</span> The following code is deliberately done inefficiently to illustrate the use of the ‘for loop’. For reference, a much more efficient code, after setting the seed, would have been
<code>y &lt;- cumsum(rnorm(n))</code></span></p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="tutorial-3-forecasting-methods-and-routines.html#cb36-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">120</span></span>
<span id="cb36-2"><a href="tutorial-3-forecasting-methods-and-routines.html#cb36-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-3"><a href="tutorial-3-forecasting-methods-and-routines.html#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb36-4"><a href="tutorial-3-forecasting-methods-and-routines.html#cb36-4" aria-hidden="true" tabindex="-1"></a>r <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n)</span>
<span id="cb36-5"><a href="tutorial-3-forecasting-methods-and-routines.html#cb36-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-6"><a href="tutorial-3-forecasting-methods-and-routines.html#cb36-6" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>,n)</span>
<span id="cb36-7"><a href="tutorial-3-forecasting-methods-and-routines.html#cb36-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-8"><a href="tutorial-3-forecasting-methods-and-routines.html#cb36-8" aria-hidden="true" tabindex="-1"></a>y[<span class="dv">1</span>] <span class="ot">&lt;-</span> r[<span class="dv">1</span>]</span>
<span id="cb36-9"><a href="tutorial-3-forecasting-methods-and-routines.html#cb36-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-10"><a href="tutorial-3-forecasting-methods-and-routines.html#cb36-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>n){</span>
<span id="cb36-11"><a href="tutorial-3-forecasting-methods-and-routines.html#cb36-11" aria-hidden="true" tabindex="-1"></a>  y[i] <span class="ot">&lt;-</span> y[i<span class="dv">-1</span>] <span class="sc">+</span> r[i]</span>
<span id="cb36-12"><a href="tutorial-3-forecasting-methods-and-routines.html#cb36-12" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Store <span class="math inline">\(y\)</span> in a <strong>data.table</strong> along with some arbitrary dates to the data (e.g., suppose we deal with the monthly series beginning from January 2011).</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="tutorial-3-forecasting-methods-and-routines.html#cb37-1" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">&lt;-</span> <span class="fu">data.table</span>(y)</span>
<span id="cb37-2"><a href="tutorial-3-forecasting-methods-and-routines.html#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="tutorial-3-forecasting-methods-and-routines.html#cb37-3" aria-hidden="true" tabindex="-1"></a>dt<span class="sc">$</span>date <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">as.Date</span>(<span class="st">"2011-01-01"</span>),<span class="at">by=</span><span class="st">"month"</span>,<span class="at">along.with=</span>y)</span></code></pre></div>
<p>Plot the realized time series using the <code>ggplot</code> function.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="tutorial-3-forecasting-methods-and-routines.html#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dt,<span class="fu">aes</span>(<span class="at">x=</span>date,<span class="at">y=</span>y))<span class="sc">+</span></span>
<span id="cb38-2"><a href="tutorial-3-forecasting-methods-and-routines.html#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size=</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb38-3"><a href="tutorial-3-forecasting-methods-and-routines.html#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Year"</span>,<span class="at">y=</span><span class="st">"Random Walk"</span>)<span class="sc">+</span></span>
<span id="cb38-4"><a href="tutorial-3-forecasting-methods-and-routines.html#cb38-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="forecasting_files/figure-html/unnamed-chunk-45-1.png" width="624"></p>
<p>Generate a sequence of one-step-ahead forecasts from January 2017 onward by simply averaging the observed time series up to the period when the forecast is made.<label for="tufte-sn-11" class="margin-toggle sidenote-number">11</label><input type="checkbox" id="tufte-sn-11" class="margin-toggle"><span class="sidenote"><span class="sidenote-number">11</span> This is equivalent to the <em>expanding window</em> scheme for generating forecasts.</span></p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="tutorial-3-forecasting-methods-and-routines.html#cb39-1" aria-hidden="true" tabindex="-1"></a>dt<span class="sc">$</span>f <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb39-2"><a href="tutorial-3-forecasting-methods-and-routines.html#cb39-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-3"><a href="tutorial-3-forecasting-methods-and-routines.html#cb39-3" aria-hidden="true" tabindex="-1"></a>R <span class="ot">&lt;-</span> <span class="fu">which</span>(dt<span class="sc">$</span>date<span class="sc">==</span><span class="fu">as.Date</span>(<span class="st">"2017-01-01"</span>))<span class="sc">-</span><span class="dv">1</span></span>
<span id="cb39-4"><a href="tutorial-3-forecasting-methods-and-routines.html#cb39-4" aria-hidden="true" tabindex="-1"></a>P <span class="ot">&lt;-</span> n<span class="sc">-</span>R</span>
<span id="cb39-5"><a href="tutorial-3-forecasting-methods-and-routines.html#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>P){</span>
<span id="cb39-6"><a href="tutorial-3-forecasting-methods-and-routines.html#cb39-6" aria-hidden="true" tabindex="-1"></a>  dt<span class="sc">$</span>f[R<span class="sc">+</span>i] <span class="ot">&lt;-</span> <span class="fu">mean</span>(dt<span class="sc">$</span>y[<span class="dv">1</span><span class="sc">:</span>(R<span class="sc">+</span>i<span class="dv">-1</span>)])</span>
<span id="cb39-7"><a href="tutorial-3-forecasting-methods-and-routines.html#cb39-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Obtain the RMSFE measure the forecast.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="tutorial-3-forecasting-methods-and-routines.html#cb40-1" aria-hidden="true" tabindex="-1"></a>dt<span class="sc">$</span>e <span class="ot">&lt;-</span> dt<span class="sc">$</span>y<span class="sc">-</span>dt<span class="sc">$</span>f</span>
<span id="cb40-2"><a href="tutorial-3-forecasting-methods-and-routines.html#cb40-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-3"><a href="tutorial-3-forecasting-methods-and-routines.html#cb40-3" aria-hidden="true" tabindex="-1"></a>rmsfe <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>(dt<span class="sc">$</span>e<span class="sc">^</span><span class="dv">2</span>,<span class="at">na.rm=</span>T))</span>
<span id="cb40-4"><a href="tutorial-3-forecasting-methods-and-routines.html#cb40-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-5"><a href="tutorial-3-forecasting-methods-and-routines.html#cb40-5" aria-hidden="true" tabindex="-1"></a>rmsfe</span></code></pre></div>
<pre><code>## [1] 5.665095</code></pre>
<p>Perform the forecast error diagnostics of the forecast.</p>
<p>Zero mean of the forecast errors: <span class="math inline">\(E(e_{t+1|t})=0\)</span>.
We test this hypothesis by regressing the forecast error on the constant, and checking whether the coefficient is statistically significantly different from zero.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="tutorial-3-forecasting-methods-and-routines.html#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">lm</span>(e<span class="sc">~</span><span class="dv">1</span>,<span class="at">data=</span>dt))<span class="sc">$</span>coefficients</span></code></pre></div>
<pre><code>##             Estimate Std. Error  t value     Pr(&gt;|t|)
## (Intercept) 5.421519  0.2396999 22.61794 6.604031e-27</code></pre>
<p>We reject the null, which suggests that we are consistently underestimating (in this case) the one-step-ahead forecasts.</p>
<p>No correlation of the forecast errors with the forecasts: <span class="math inline">\(Cov(e_{t+1|t},y_{t+1|t})=0\)</span>. We perform this test by regressing the forecast error on the forecast, and checking whether the slope coefficient is statistically significantly different from zero.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="tutorial-3-forecasting-methods-and-routines.html#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">lm</span>(e<span class="sc">~</span>f,<span class="at">data=</span>dt))<span class="sc">$</span>coefficients</span></code></pre></div>
<pre><code>##               Estimate Std. Error    t value     Pr(&gt;|t|)
## (Intercept) -0.1437252  1.5861275 -0.0906139 0.9281928187
## f            0.9995059  0.2822414  3.5413157 0.0009247749</code></pre>
<p>We reject the null, which suggests that there is some information in the data that we do not use well enough.<label for="tufte-sn-12" class="margin-toggle sidenote-number">12</label><input type="checkbox" id="tufte-sn-12" class="margin-toggle"><span class="sidenote"><span class="sidenote-number">12</span> Because, as we know, the true data generating process is random walk, a better use of information would involve assigning all the weights to the most recent observation rather than spreading them evenly across all observations in the estimation window.</span></p>
<p>No serial correlation in one-step-ahead forecast errors: <span class="math inline">\(Cov(e_{t+1|t},y_{t|t-1})=0\)</span>. We perform this test by regressing the forecast error on its lag, and checking whether the slope coefficient is statistically significantly different from zero.<label for="tufte-sn-13" class="margin-toggle sidenote-number">13</label><input type="checkbox" id="tufte-sn-13" class="margin-toggle"><span class="sidenote"><span class="sidenote-number">13</span> Note: first we need to generate lagged forecast errors.</span></p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="tutorial-3-forecasting-methods-and-routines.html#cb46-1" aria-hidden="true" tabindex="-1"></a>dt[,<span class="st">`</span><span class="at">:=</span><span class="st">`</span>(<span class="at">e1=</span><span class="fu">shift</span>(e))]</span>
<span id="cb46-2"><a href="tutorial-3-forecasting-methods-and-routines.html#cb46-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-3"><a href="tutorial-3-forecasting-methods-and-routines.html#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">lm</span>(e<span class="sc">~</span>e1,<span class="at">data=</span>dt))<span class="sc">$</span>coefficients</span></code></pre></div>
<pre><code>##              Estimate Std. Error   t value     Pr(&gt;|t|)
## (Intercept) 0.7057751 0.40681156  1.734894 8.960477e-02
## e1          0.8661231 0.07198491 12.032009 1.164311e-15</code></pre>
<p>We reject the null, which again, suggests that the method that we have chosen for forecasting is far from ideal.</p>
<!-- **(this is a direct/iterated stuff)** -->
<!-- In this tutorial, we will generate a time series, we will obtain multi-step-ahead forecasts using direct and iterated methods from autoregressive models using a rolling window procedure, and we will assess the accuracy of the forecast. We will then turn to interval forecasts, and we will assess their coverage accuracy. To run the code, the `data.table`, `ggplot2`, `lmtest`, and `sandwich` packages need to be installed and loaded. -->
<!-- Let's generate a time series that follow an AR(2) process as follows:  -->
<!-- $$y_t = 0.01t+0.6y_{t-1}+0.2y_{t-2}+\varepsilon_t$$ -->
<!-- where $e_{t} \sim N(0,1)$.  -->
<!-- ```{r echo=TRUE} -->
<!-- n <- 240 -->
<!-- set.seed(9) -->
<!-- e <- rnorm(n,0,1) -->
<!-- y <- rep(NA,n) -->
<!-- y[1] <- 0.01+e[1] -->
<!-- y[2] <- 0.02+0.6*y[1]+e[2] -->
<!-- for(i in 3:n){ -->
<!--   y[i] <- 0.01*i+0.6*y[i-1]+0.2*y[i-2]+e[i] -->
<!-- } -->
<!-- ``` -->
<!-- Generate a vector of arbitrary dates (e.g., the monthly series beginning from January 2000), store these along with $y$ in a **data.table**, call it 'dt', and plot the realized time series using the **ggplot** function. -->
<!-- ```{r echo=TRUE} -->
<!-- date <- seq(as.Date("2000-01-01"),by="month",along.with=y) -->
<!-- dt <- data.table(date,y) -->
<!-- ggplot(dt,aes(x=date,y=y))+ -->
<!--   geom_line(size=1)+ -->
<!--   labs(x="Year",y="Series")+ -->
<!--   theme_classic() -->
<!-- ``` -->
<!-- Suppose we believe the series follow either the AR(1) or the AR(2) process, and that we want to compare iterated multi-step forecasts obtained from these models to direct multi-step forecasts. In what follows, we will generate twelve-step-ahead point forecasts from these two methods for the considered two models using the rolling window scheme, where the first rolling window ranges from period 1 to period 180. In obtaining the iterated multi-step forecasts, for each rolling window, we will generate a sequence of one-to-twelve-step-ahead forecasts, but only retain the twelve-step-ahead forecasts.  -->
<!-- ```{r echo=TRUE} -->
<!-- h <- 12 -->
<!-- dt <- dt[,.(date,y,y1=shift(y,1),y2=shift(y,2),y12=shift(y,h),y13=shift(y,h+1))] -->
<!-- dt <- dt[complete.cases(dt)] -->
<!-- dt[,`:=`(a1i=as.numeric(NA),a1d=as.numeric(NA),a2i=as.numeric(NA),a2d=as.numeric(NA))] -->
<!-- R <- 180 -->
<!-- P <- nrow(dt)-R-h+1 -->
<!-- for(i in 1:P){ -->
<!--   ### iterated multi-step method -->
<!--   a1i <- lm(y~y1,data=dt[i:(R+i-1)]) -->
<!--   a2i <- lm(y~y1+y2,data=dt[i:(R+i-1)]) -->
<!--   iter_dt <- data.table(hor=1:h,a1=as.numeric(NA),a2=as.numeric(NA)) -->
<!--   ## AR(1) -->
<!--   iter_dt$a1[1] <- a1i$coefficients[1]+a1i$coefficients[2]*dt[R+i-1]$y -->
<!--   for(j in 2:h){ -->
<!--     iter_dt$a1[j] <- a1i$coefficients[1]+a1i$coefficients[2]*iter_dt$a1[j-1] -->
<!--   } -->
<!--   ## AR(2) -->
<!--   iter_dt$a2[1] <- a2i$coefficients[1]+a2i$coefficients[2]*dt[R+i-1]$y+a2i$coefficients[3]*dt[R+i-1]$y1 -->
<!--   iter_dt$a2[2] <- a2i$coefficients[1]+a2i$coefficients[2]*iter_dt$a2[1]+a2i$coefficients[3]*dt[R+i-1]$y -->
<!--   for(j in 3:h){ -->
<!--     iter_dt$a2[j] <- a2i$coefficients[1]+a2i$coefficients[2]*iter_dt$a2[j-1]+a2i$coefficients[3]*iter_dt$a2[j-2] -->
<!--   } -->
<!--   dt$a1i[R+i+h-1] <- iter_dt$a1[h] -->
<!--   dt$a2i[R+i+h-1] <- iter_dt$a2[h] -->
<!--   ### direct multi-step method -->
<!--   a1d <- lm(y~y12,data=dt[i:(R+i-1)]) -->
<!--   a2d <- lm(y~y12+y13,data=dt[i:(R+i-1)]) -->
<!--   dt$a1d[R+i+h-1] <- a1d$coefficients[1]+a1d$coefficients[2]*dt[R+i-1]$y -->
<!--   dt$a2d[R+i+h-1] <- a2d$coefficients[1]+a2d$coefficients[2]*dt[R+i-1]$y+a2d$coefficients[3]*dt[R+i-1]$y1 -->
<!-- } -->
<!-- ``` -->
<!-- We can now test whether the forecasts of the iterated method 'statistically significantly' outperform those of the direct method? -->
<!-- ```{r echo=TRUE} -->
<!-- dt$a1i_e <- dt$y-dt$a1i -->
<!-- dt$a2i_e <- dt$y-dt$a2i -->
<!-- dt$a1d_e <- dt$y-dt$a1d -->
<!-- dt$a2d_e <- dt$y-dt$a2d -->
<!-- dt$ld1 <- dt$a1d_e^2-dt$a1i_e^2 -->
<!-- dt$ld2 <- dt$a2d_e^2-dt$a2i_e^2 -->
<!-- reg_ld1 <- lm(ld1~1,data=dt) -->
<!-- reg_ld2 <- lm(ld2~1,data=dt) -->
<!-- coeftest(reg_ld1,vcov.=vcovHAC(reg_ld1)) -->
<!-- coeftest(reg_ld2,vcov.=vcovHAC(reg_ld2)) -->
<!-- ``` -->
<!-- Obtain interval forecasts for horizon 12 using the direct method for an AR(1) model and a linear trend model; plot these interval forecasts along with the observed series. -->
<!-- ```{r echo=TRUE} -->
<!-- dt$trend <- c(1:nrow(dt)) -->
<!-- dt[,`:=`(a1dl=as.numeric(NA),a1du=as.numeric(NA),trdl=as.numeric(NA),trdu=as.numeric(NA))] -->
<!-- for(i in 1:P){ -->
<!--   a1d <- lm(y~y12,data=dt[i:(R+i-1)]) -->
<!--   trd <- lm(y~trend,data=dt[i:(R+i-1)]) -->
<!--   a1d_pf <- a1d$coefficients[1]+a1d$coefficients[2]*dt[R+i-1]$y -->
<!--   trd_pf <- trd$coefficients[1]+trd$coefficients[2]*dt[R+i-1+h]$trend -->
<!--   a1d_sd <- summary(a1d)$sigma -->
<!--   trd_sd <- summary(trd)$sigma -->
<!--   dt$a1dl[R+i+h-1] <- a1d_pf-1.96*a1d_sd -->
<!--   dt$a1du[R+i+h-1] <- a1d_pf+1.96*a1d_sd -->
<!--   dt$trdl[R+i+h-1] <- trd_pf-1.96*trd_sd -->
<!--   dt$trdu[R+i+h-1] <- trd_pf+1.96*trd_sd -->
<!-- } -->
<!-- ggplot(dt,aes(x=date,y=y))+ -->
<!--   geom_line(size=1,color="black")+ -->
<!--   geom_line(aes(y=a1dl),size=1,color="steelblue",linetype=5,na.rm=T)+ -->
<!--   geom_line(aes(y=a1du),size=1,color="steelblue",linetype=5,na.rm=T)+ -->
<!--   geom_line(aes(y=trdl),size=1,color="indianred",linetype=5,na.rm=T)+ -->
<!--   geom_line(aes(y=trdu),size=1,color="indianred",linetype=5,na.rm=T)+ -->
<!--   theme_classic() -->
<!-- ``` -->
<!-- Test the unconditional coverage of the interval forecasts from the considered two models. -->
<!-- ```{r echo=TRUE} -->
<!-- dt[,`:=`(i1=ifelse(y>=a1dl & y<=a1du,1,0),it=ifelse(y>=trdl & y<=trdu,1,0))] -->
<!-- # AR(1) -->
<!-- p1 <- mean(dt$i1,na.rm=T) -->
<!-- L10 <- (1-.95)^(P*(1-p1))*(.95)^(P*p1) -->
<!-- L11 <- (1-p1)^(P*(1-p1))*(p1)^(P*p1) -->
<!-- LR1 <- -2*log(L10/L11) -->
<!-- pchisq(LR1,df=1,lower.tail=F) -->
<!-- # AR(2) -->
<!-- p2 <- mean(dt$it,na.rm=T) -->
<!-- L20 <- (1-.95)^(P*(1-p2))*(.95)^(P*p2) -->
<!-- L21 <- (1-p2)^(P*(1-p2))*(p2)^(P*p2) -->
<!-- LR2 <- -2*log(L20/L21) -->
<!-- pchisq(LR2,df=1,lower.tail=F) -->
<!-- ``` -->

</div>
<p style="text-align: center;">
<a href="tutorial-2-data-management-and-visualisation.html"><button class="btn btn-default">Previous</button></a>
<a href="tutorial-4-trends-and-seasonality.html"><button class="btn btn-default">Next</button></a>
</p>
<p class="build-date">Page built: 
2022-08-20
 using 
R version 4.1.2 (2021-11-01)
</p>
</div>
</div>



</body>
</html>
