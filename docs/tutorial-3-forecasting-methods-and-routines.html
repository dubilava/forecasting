<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="Tutorial 3: Forecasting Methods and Routines | Forecasting With Time Series Models Using R" />
<meta property="og:type" content="book" />
<meta property="og:image" content="/forecasting-logo.png" />
<meta property="og:description" content="Tutorial 3: Forecasting Methods and Routines | Forecasting With Time Series Models Using R" />


<meta name="author" content="David Ubilava" />


<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<meta name="description" content="Tutorial 3: Forecasting Methods and Routines | Forecasting With Time Series Models Using R">

<title>Tutorial 3: Forecasting Methods and Routines | Forecasting With Time Series Models Using R</title>

<link href="libs/tufte-css-2015.12.29/tufte.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/envisioned.css" rel="stylesheet" />
<link href="libs/msmb-css-0/msmb.css" rel="stylesheet" />
<script>
function toggle_visibility(id1, id2) {
var e = document.getElementById(id1);
var f = document.getElementById(id2);

e.style.display = ((e.style.display!='none') ? 'none' : 'block');

if(f.classList.contains('fa-plus-square')) {
    f.classList.add('fa-minus-square')
    f.classList.remove('fa-plus-square')
} else {
    f.classList.add('fa-plus-square')
    f.classList.remove('fa-minus-square')
}

}
</script>
<script>
function copy_link(id) {
  var dummy = document.createElement('input'),
  text = window.location.href.split(/[?#]/)[0] + '#' + id;
  document.body.appendChild(dummy);
  dummy.value = text;
  dummy.select();
  document.execCommand('copy');
  document.body.removeChild(dummy);
  
  var tooltip = document.getElementById(id + '-tooltip');
  tooltip.innerHTML = 'Copied!';
}

function reset_tooltip(id) {
  var tooltip = document.getElementById(id);
  tooltip.innerHTML = 'Copy link';
}
</script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }

code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>



<link rel="stylesheet" href="style.css" type="text/css" />

</head>

<body>



<div class="row">
<div class="col-sm-12">
<div id="TOC">
<ul class="navbar">
<li class="msmb"><p class="title">Forecasting With Time Series Models Using R<p><p class="author">David Ubilava</p>
<li class="dropdown" style="float:right">
<a href="javascript:void(0)" class="dropbtn">&#x25BE; Chapters</a>
<div class="dropdown-content">
<a href="index.html">Foreword</a>
<a href="forecasting-with-time-series-models.html">Forecasting With Time Series Models</a>
<a href="introduction-to-forecasting.html"><span class="toc-section-number">1</span> Introduction to Forecasting</a>
<a href="features-of-time-series-data.html"><span class="toc-section-number">2</span> Features of Time Series Data</a>
<a href="forecasting-methods-and-routines.html"><span class="toc-section-number">3</span> Forecasting Methods and Routines</a>
<a href="trends-and-seasonality.html"><span class="toc-section-number">4</span> Trends and Seasonality</a>
<a href="autoregressive-models.html"><span class="toc-section-number">5</span> Autoregressive Models</a>
<a href="vector-autoregressive-models.html"><span class="toc-section-number">6</span> Vector Autoregressive Models</a>
<a href="dynamic-factor-models.html"><span class="toc-section-number">7</span> Dynamic Factor Models</a>
<a href="threshold-autoregressive-models.html"><span class="toc-section-number">8</span> Threshold Autoregressive Models</a>
<a href="forecast-evaluation.html"><span class="toc-section-number">9</span> Forecast Evaluation</a>
<a href="forecast-combination.html"><span class="toc-section-number">10</span> Forecast Combination</a>
<a href="forecasting-using-r.html">Forecasting Using R</a>
<a href="tutorial-1-introduction-to-r.html">Tutorial 1: Introduction to R</a>
<a href="tutorial-2-data-management.html">Tutorial 2: Data Management</a>
<a id="active-page" href="tutorial-3-forecasting-methods-and-routines.html">Tutorial 3: Forecasting Methods and Routines</a>
<a href="tutorial-4-trends-and-seasonality.html">Tutorial 4: Trends and Seasonality</a>
<a href="tutorial-5-autoregressive-models.html">Tutorial 5: Autoregressive Models</a>
<a href="tutorial-6-vector-autoregressive-models.html">Tutorial 6: Vector Autoregressive Models</a>
<a href="tutorial-7-dynamic-factor-models.html">Tutorial 7: Dynamic Factor Models</a>
<a href="tutorial-8-threshold-autoregression.html">Tutorial 8: Threshold Autoregression</a>
<a href="tutorial-9-forecast-evaluation.html">Tutorial 9: Forecast Evaluation</a>
<a href="tutorial-10-forecast-combination.html">Tutorial 10: Forecast Combination</a>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="row">
<div class="col-sm-12">
<div id="tutorial-3-forecasting-methods-and-routines" class="section level1 unnumbered">
<h1>Tutorial 3: Forecasting Methods and Routines</h1>
<p>In this tutorial, we will introduce ‘for loop’, and use it to generate time series as well as to obtain one-step-ahead forecasts using a rolling window procedure; we will also perform forecast error diagnostics.</p>
<p>Let’s generate a random walk process, such that <span class="math inline">\(y_{t} = y_{t-1}+e_{t}\)</span>, where <span class="math inline">\(e_{t} ~ N(0,1)\)</span>, and where <span class="math inline">\(y_{0}=0\)</span>, for <span class="math inline">\(t=1,\ldots,120\)</span>.</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="tutorial-3-forecasting-methods-and-routines.html#cb51-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">120</span></span>
<span id="cb51-2"><a href="tutorial-3-forecasting-methods-and-routines.html#cb51-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-3"><a href="tutorial-3-forecasting-methods-and-routines.html#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb51-4"><a href="tutorial-3-forecasting-methods-and-routines.html#cb51-4" aria-hidden="true" tabindex="-1"></a>e <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n)</span>
<span id="cb51-5"><a href="tutorial-3-forecasting-methods-and-routines.html#cb51-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-6"><a href="tutorial-3-forecasting-methods-and-routines.html#cb51-6" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>,n)</span>
<span id="cb51-7"><a href="tutorial-3-forecasting-methods-and-routines.html#cb51-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-8"><a href="tutorial-3-forecasting-methods-and-routines.html#cb51-8" aria-hidden="true" tabindex="-1"></a>y[<span class="dv">1</span>] <span class="ot">&lt;-</span> e[<span class="dv">1</span>]</span>
<span id="cb51-9"><a href="tutorial-3-forecasting-methods-and-routines.html#cb51-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-10"><a href="tutorial-3-forecasting-methods-and-routines.html#cb51-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>n){</span>
<span id="cb51-11"><a href="tutorial-3-forecasting-methods-and-routines.html#cb51-11" aria-hidden="true" tabindex="-1"></a>  y[i] <span class="ot">&lt;-</span> y[i<span class="dv">-1</span>] <span class="sc">+</span> e[i]</span>
<span id="cb51-12"><a href="tutorial-3-forecasting-methods-and-routines.html#cb51-12" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Store <span class="math inline">\(y\)</span> and <span class="math inline">\(e\)</span> in a <strong>data.table</strong>, call it ‘dt’. Add some arbitrary dates to the data (e.g., suppose we deal with the monthly series beginning from January 2011).</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="tutorial-3-forecasting-methods-and-routines.html#cb52-1" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">&lt;-</span> <span class="fu">data.table</span>(y,e)</span>
<span id="cb52-2"><a href="tutorial-3-forecasting-methods-and-routines.html#cb52-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-3"><a href="tutorial-3-forecasting-methods-and-routines.html#cb52-3" aria-hidden="true" tabindex="-1"></a>dt<span class="sc">$</span>date <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">as.Date</span>(<span class="st">"2011-01-01"</span>),<span class="fu">as.Date</span>(<span class="st">"2020-12-01"</span>),<span class="at">by=</span><span class="st">"month"</span>)</span></code></pre></div>
<p>Plot the realized time series using <strong>ggplot</strong> function.</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="tutorial-3-forecasting-methods-and-routines.html#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dt,<span class="fu">aes</span>(<span class="at">x=</span>date,<span class="at">y=</span>y))<span class="sc">+</span></span>
<span id="cb53-2"><a href="tutorial-3-forecasting-methods-and-routines.html#cb53-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size=</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb53-3"><a href="tutorial-3-forecasting-methods-and-routines.html#cb53-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Year"</span>,<span class="at">y=</span><span class="st">"Random Walk"</span>)<span class="sc">+</span></span>
<span id="cb53-4"><a href="tutorial-3-forecasting-methods-and-routines.html#cb53-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="forecasting_files/figure-html/unnamed-chunk-49-1.png" width="624"></p>
<p>Generate a sequence of one-step-ahead forecasts from naive and average methods, using the rolling window scheme, where the first rolling window ranges from period 1 to period 80.</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="tutorial-3-forecasting-methods-and-routines.html#cb54-1" aria-hidden="true" tabindex="-1"></a>dt<span class="sc">$</span>average <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb54-2"><a href="tutorial-3-forecasting-methods-and-routines.html#cb54-2" aria-hidden="true" tabindex="-1"></a>dt<span class="sc">$</span>naive <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb54-3"><a href="tutorial-3-forecasting-methods-and-routines.html#cb54-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-4"><a href="tutorial-3-forecasting-methods-and-routines.html#cb54-4" aria-hidden="true" tabindex="-1"></a>R <span class="ot">&lt;-</span> <span class="dv">80</span></span>
<span id="cb54-5"><a href="tutorial-3-forecasting-methods-and-routines.html#cb54-5" aria-hidden="true" tabindex="-1"></a>P <span class="ot">&lt;-</span> n<span class="sc">-</span>R</span>
<span id="cb54-6"><a href="tutorial-3-forecasting-methods-and-routines.html#cb54-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>P){</span>
<span id="cb54-7"><a href="tutorial-3-forecasting-methods-and-routines.html#cb54-7" aria-hidden="true" tabindex="-1"></a>  w <span class="ot">&lt;-</span> y[i<span class="sc">:</span>(R<span class="dv">-1</span><span class="sc">+</span>i)]</span>
<span id="cb54-8"><a href="tutorial-3-forecasting-methods-and-routines.html#cb54-8" aria-hidden="true" tabindex="-1"></a>  dt<span class="sc">$</span>average[R<span class="sc">+</span>i] <span class="ot">&lt;-</span> <span class="fu">mean</span>(w)</span>
<span id="cb54-9"><a href="tutorial-3-forecasting-methods-and-routines.html#cb54-9" aria-hidden="true" tabindex="-1"></a>  dt<span class="sc">$</span>naive[R<span class="sc">+</span>i] <span class="ot">&lt;-</span> w[<span class="fu">length</span>(w)]</span>
<span id="cb54-10"><a href="tutorial-3-forecasting-methods-and-routines.html#cb54-10" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Calculate the RMSFE measures for each of the two forecasting methods.</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="tutorial-3-forecasting-methods-and-routines.html#cb55-1" aria-hidden="true" tabindex="-1"></a>dt[,<span class="st">`</span><span class="at">:=</span><span class="st">`</span>(<span class="at">e_average=</span>y<span class="sc">-</span>average,<span class="at">e_naive=</span>y<span class="sc">-</span>naive)]</span>
<span id="cb55-2"><a href="tutorial-3-forecasting-methods-and-routines.html#cb55-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-3"><a href="tutorial-3-forecasting-methods-and-routines.html#cb55-3" aria-hidden="true" tabindex="-1"></a>rmsfe_average <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>(dt<span class="sc">$</span>e_average<span class="sc">^</span><span class="dv">2</span>,<span class="at">na.rm=</span>T))</span>
<span id="cb55-4"><a href="tutorial-3-forecasting-methods-and-routines.html#cb55-4" aria-hidden="true" tabindex="-1"></a>rmsfe_naive <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>(dt<span class="sc">$</span>e_naive<span class="sc">^</span><span class="dv">2</span>,<span class="at">na.rm=</span>T))</span>
<span id="cb55-5"><a href="tutorial-3-forecasting-methods-and-routines.html#cb55-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-6"><a href="tutorial-3-forecasting-methods-and-routines.html#cb55-6" aria-hidden="true" tabindex="-1"></a>rmsfe_average</span></code></pre></div>
<pre><code>## [1] 4.672947</code></pre>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="tutorial-3-forecasting-methods-and-routines.html#cb57-1" aria-hidden="true" tabindex="-1"></a>rmsfe_naive</span></code></pre></div>
<pre><code>## [1] 0.850081</code></pre>
<p>Perform the forecast error diagnostics for the two considered methods.</p>
<p>Zero mean of the forecast errors: <span class="math inline">\(E(e_{t+1|t})=0\)</span>.
We perform this test by regressing the forecast error on the constant, and checking whether the coefficient is statistically significantly different from zero.</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="tutorial-3-forecasting-methods-and-routines.html#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">lm</span>(e_average<span class="sc">~</span><span class="dv">1</span>,<span class="at">data=</span>dt))<span class="sc">$</span>coefficients</span></code></pre></div>
<pre><code>##             Estimate Std. Error  t value     Pr(&gt;|t|)
## (Intercept) 4.434858  0.2358002 18.80769 3.682273e-21</code></pre>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="tutorial-3-forecasting-methods-and-routines.html#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">lm</span>(e_naive<span class="sc">~</span><span class="dv">1</span>,<span class="at">data=</span>dt))<span class="sc">$</span>coefficients</span></code></pre></div>
<pre><code>##              Estimate Std. Error t value Pr(&gt;|t|)
## (Intercept) 0.1168396    0.13483 0.86657 0.391478</code></pre>
<p>No correlation of the forecast errors with the forecasts: <span class="math inline">\(Cov(e_{t+1|t},y_{t+1|t})=0\)</span>. We perform this test by regressing the forecast error on the forecast, and checking whether the slope coefficient is statistically significantly different from zero.</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="tutorial-3-forecasting-methods-and-routines.html#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">lm</span>(e_average<span class="sc">~</span>average,<span class="at">data=</span>dt))<span class="sc">$</span>coefficients</span></code></pre></div>
<pre><code>##              Estimate Std. Error  t value   Pr(&gt;|t|)
## (Intercept) 2.4180785  1.2929708 1.870172 0.06917788
## average     0.2942557  0.1856048 1.585389 0.12116580</code></pre>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="tutorial-3-forecasting-methods-and-routines.html#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">lm</span>(e_naive<span class="sc">~</span>naive,<span class="at">data=</span>dt))<span class="sc">$</span>coefficients</span></code></pre></div>
<pre><code>##                Estimate Std. Error   t value  Pr(&gt;|t|)
## (Intercept)  1.06489905 0.69740557  1.526944 0.1350565
## naive       -0.08486143 0.06127484 -1.384931 0.1741512</code></pre>
<p>No serial correlation in one-step-ahead forecast errors: <span class="math inline">\(Cov(e_{t+1|t},y_{t|t-1})=0\)</span>. We perform this test by regressing the forecast error on its lag, and checking whether the slope coefficient is statistically significantly different from zero.
(Note: first we need to generate lagged forecast errors)</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="tutorial-3-forecasting-methods-and-routines.html#cb67-1" aria-hidden="true" tabindex="-1"></a>dt[,<span class="st">`</span><span class="at">:=</span><span class="st">`</span>(<span class="at">e_average.l1=</span><span class="fu">shift</span>(e_average),<span class="at">e_naive.l1=</span><span class="fu">shift</span>(e_naive))]</span>
<span id="cb67-2"><a href="tutorial-3-forecasting-methods-and-routines.html#cb67-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-3"><a href="tutorial-3-forecasting-methods-and-routines.html#cb67-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">lm</span>(e_average<span class="sc">~</span>e_average.l1,<span class="at">data=</span>dt))<span class="sc">$</span>coefficients</span></code></pre></div>
<pre><code>##               Estimate Std. Error  t value     Pr(&gt;|t|)
## (Intercept)  0.7898068 0.42027705 1.879253 6.810403e-02
## e_average.l1 0.8275396 0.08966026 9.229726 3.892504e-11</code></pre>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="tutorial-3-forecasting-methods-and-routines.html#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">lm</span>(e_naive<span class="sc">~</span>e_naive.l1,<span class="at">data=</span>dt))<span class="sc">$</span>coefficients</span></code></pre></div>
<pre><code>##               Estimate Std. Error   t value  Pr(&gt;|t|)
## (Intercept) 0.12971406  0.1403668 0.9241081 0.3614178
## e_naive.l1  0.03780853  0.1631333 0.2317647 0.8179979</code></pre>
<p><strong>(this is a direct/iterated stuff)</strong></p>
<p>In this tutorial, we will generate a time series, we will obtain multi-step-ahead forecasts using direct and iterated methods from autoregressive models using a rolling window procedure, and we will assess the accuracy of the forecast. We will then turn to interval forecasts, and we will assess their coverage accuracy. To run the code, the <code>data.table</code>, <code>ggplot2</code>, <code>lmtest</code>, and <code>sandwich</code> packages need to be installed and loaded.</p>
<p>Let’s generate a time series that follow an AR(2) process as follows:
<span class="math display">\[y_t = 0.01t+0.6y_{t-1}+0.2y_{t-2}+\varepsilon_t\]</span>
where <span class="math inline">\(e_{t} \sim N(0,1)\)</span>.</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="tutorial-3-forecasting-methods-and-routines.html#cb71-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">240</span></span>
<span id="cb71-2"><a href="tutorial-3-forecasting-methods-and-routines.html#cb71-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-3"><a href="tutorial-3-forecasting-methods-and-routines.html#cb71-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">9</span>)</span>
<span id="cb71-4"><a href="tutorial-3-forecasting-methods-and-routines.html#cb71-4" aria-hidden="true" tabindex="-1"></a>e <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n,<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb71-5"><a href="tutorial-3-forecasting-methods-and-routines.html#cb71-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-6"><a href="tutorial-3-forecasting-methods-and-routines.html#cb71-6" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>,n)</span>
<span id="cb71-7"><a href="tutorial-3-forecasting-methods-and-routines.html#cb71-7" aria-hidden="true" tabindex="-1"></a>y[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fl">0.01</span><span class="sc">+</span>e[<span class="dv">1</span>]</span>
<span id="cb71-8"><a href="tutorial-3-forecasting-methods-and-routines.html#cb71-8" aria-hidden="true" tabindex="-1"></a>y[<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fl">0.02+0.6</span><span class="sc">*</span>y[<span class="dv">1</span>]<span class="sc">+</span>e[<span class="dv">2</span>]</span>
<span id="cb71-9"><a href="tutorial-3-forecasting-methods-and-routines.html#cb71-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">3</span><span class="sc">:</span>n){</span>
<span id="cb71-10"><a href="tutorial-3-forecasting-methods-and-routines.html#cb71-10" aria-hidden="true" tabindex="-1"></a>  y[i] <span class="ot">&lt;-</span> <span class="fl">0.01</span><span class="sc">*</span>i<span class="fl">+0.6</span><span class="sc">*</span>y[i<span class="dv">-1</span>]<span class="sc">+</span><span class="fl">0.2</span><span class="sc">*</span>y[i<span class="dv">-2</span>]<span class="sc">+</span>e[i]</span>
<span id="cb71-11"><a href="tutorial-3-forecasting-methods-and-routines.html#cb71-11" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Generate a vector of arbitrary dates (e.g., the monthly series beginning from January 2000), store these along with <span class="math inline">\(y\)</span> in a <strong>data.table</strong>, call it ‘dt’, and plot the realized time series using the <strong>ggplot</strong> function.</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="tutorial-3-forecasting-methods-and-routines.html#cb72-1" aria-hidden="true" tabindex="-1"></a>date <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">as.Date</span>(<span class="st">"2000-01-01"</span>),<span class="at">by=</span><span class="st">"month"</span>,<span class="at">along.with=</span>y)</span>
<span id="cb72-2"><a href="tutorial-3-forecasting-methods-and-routines.html#cb72-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-3"><a href="tutorial-3-forecasting-methods-and-routines.html#cb72-3" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">&lt;-</span> <span class="fu">data.table</span>(date,y)</span>
<span id="cb72-4"><a href="tutorial-3-forecasting-methods-and-routines.html#cb72-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-5"><a href="tutorial-3-forecasting-methods-and-routines.html#cb72-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dt,<span class="fu">aes</span>(<span class="at">x=</span>date,<span class="at">y=</span>y))<span class="sc">+</span></span>
<span id="cb72-6"><a href="tutorial-3-forecasting-methods-and-routines.html#cb72-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size=</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb72-7"><a href="tutorial-3-forecasting-methods-and-routines.html#cb72-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Year"</span>,<span class="at">y=</span><span class="st">"Series"</span>)<span class="sc">+</span></span>
<span id="cb72-8"><a href="tutorial-3-forecasting-methods-and-routines.html#cb72-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="forecasting_files/figure-html/unnamed-chunk-56-1.png" width="624"></p>
<p>Suppose we believe the series follow either the AR(1) or the AR(2) process, and that we want to compare iterated multi-step forecasts obtained from these models to direct multi-step forecasts. In what follows, we will generate twelve-step-ahead point forecasts from these two methods for the considered two models using the rolling window scheme, where the first rolling window ranges from period 1 to period 180. In obtaining the iterated multi-step forecasts, for each rolling window, we will generate a sequence of one-to-twelve-step-ahead forecasts, but only retain the twelve-step-ahead forecasts.</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="tutorial-3-forecasting-methods-and-routines.html#cb73-1" aria-hidden="true" tabindex="-1"></a>h <span class="ot">&lt;-</span> <span class="dv">12</span></span>
<span id="cb73-2"><a href="tutorial-3-forecasting-methods-and-routines.html#cb73-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-3"><a href="tutorial-3-forecasting-methods-and-routines.html#cb73-3" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">&lt;-</span> dt[,.(date,y,<span class="at">y1=</span><span class="fu">shift</span>(y,<span class="dv">1</span>),<span class="at">y2=</span><span class="fu">shift</span>(y,<span class="dv">2</span>),<span class="at">y12=</span><span class="fu">shift</span>(y,h),<span class="at">y13=</span><span class="fu">shift</span>(y,h<span class="sc">+</span><span class="dv">1</span>))]</span>
<span id="cb73-4"><a href="tutorial-3-forecasting-methods-and-routines.html#cb73-4" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">&lt;-</span> dt[<span class="fu">complete.cases</span>(dt)]</span>
<span id="cb73-5"><a href="tutorial-3-forecasting-methods-and-routines.html#cb73-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-6"><a href="tutorial-3-forecasting-methods-and-routines.html#cb73-6" aria-hidden="true" tabindex="-1"></a>dt[,<span class="st">`</span><span class="at">:=</span><span class="st">`</span>(<span class="at">a1i=</span><span class="fu">as.numeric</span>(<span class="cn">NA</span>),<span class="at">a1d=</span><span class="fu">as.numeric</span>(<span class="cn">NA</span>),<span class="at">a2i=</span><span class="fu">as.numeric</span>(<span class="cn">NA</span>),<span class="at">a2d=</span><span class="fu">as.numeric</span>(<span class="cn">NA</span>))]</span>
<span id="cb73-7"><a href="tutorial-3-forecasting-methods-and-routines.html#cb73-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-8"><a href="tutorial-3-forecasting-methods-and-routines.html#cb73-8" aria-hidden="true" tabindex="-1"></a>R <span class="ot">&lt;-</span> <span class="dv">180</span></span>
<span id="cb73-9"><a href="tutorial-3-forecasting-methods-and-routines.html#cb73-9" aria-hidden="true" tabindex="-1"></a>P <span class="ot">&lt;-</span> <span class="fu">nrow</span>(dt)<span class="sc">-</span>R<span class="sc">-</span>h<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb73-10"><a href="tutorial-3-forecasting-methods-and-routines.html#cb73-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-11"><a href="tutorial-3-forecasting-methods-and-routines.html#cb73-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>P){</span>
<span id="cb73-12"><a href="tutorial-3-forecasting-methods-and-routines.html#cb73-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb73-13"><a href="tutorial-3-forecasting-methods-and-routines.html#cb73-13" aria-hidden="true" tabindex="-1"></a>  <span class="do">### iterated multi-step method</span></span>
<span id="cb73-14"><a href="tutorial-3-forecasting-methods-and-routines.html#cb73-14" aria-hidden="true" tabindex="-1"></a>  a1i <span class="ot">&lt;-</span> <span class="fu">lm</span>(y<span class="sc">~</span>y1,<span class="at">data=</span>dt[i<span class="sc">:</span>(R<span class="sc">+</span>i<span class="dv">-1</span>)])</span>
<span id="cb73-15"><a href="tutorial-3-forecasting-methods-and-routines.html#cb73-15" aria-hidden="true" tabindex="-1"></a>  a2i <span class="ot">&lt;-</span> <span class="fu">lm</span>(y<span class="sc">~</span>y1<span class="sc">+</span>y2,<span class="at">data=</span>dt[i<span class="sc">:</span>(R<span class="sc">+</span>i<span class="dv">-1</span>)])</span>
<span id="cb73-16"><a href="tutorial-3-forecasting-methods-and-routines.html#cb73-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb73-17"><a href="tutorial-3-forecasting-methods-and-routines.html#cb73-17" aria-hidden="true" tabindex="-1"></a>  iter_dt <span class="ot">&lt;-</span> <span class="fu">data.table</span>(<span class="at">hor=</span><span class="dv">1</span><span class="sc">:</span>h,<span class="at">a1=</span><span class="fu">as.numeric</span>(<span class="cn">NA</span>),<span class="at">a2=</span><span class="fu">as.numeric</span>(<span class="cn">NA</span>))</span>
<span id="cb73-18"><a href="tutorial-3-forecasting-methods-and-routines.html#cb73-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb73-19"><a href="tutorial-3-forecasting-methods-and-routines.html#cb73-19" aria-hidden="true" tabindex="-1"></a>  <span class="do">## AR(1)</span></span>
<span id="cb73-20"><a href="tutorial-3-forecasting-methods-and-routines.html#cb73-20" aria-hidden="true" tabindex="-1"></a>  iter_dt<span class="sc">$</span>a1[<span class="dv">1</span>] <span class="ot">&lt;-</span> a1i<span class="sc">$</span>coefficients[<span class="dv">1</span>]<span class="sc">+</span>a1i<span class="sc">$</span>coefficients[<span class="dv">2</span>]<span class="sc">*</span>dt[R<span class="sc">+</span>i<span class="dv">-1</span>]<span class="sc">$</span>y</span>
<span id="cb73-21"><a href="tutorial-3-forecasting-methods-and-routines.html#cb73-21" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>h){</span>
<span id="cb73-22"><a href="tutorial-3-forecasting-methods-and-routines.html#cb73-22" aria-hidden="true" tabindex="-1"></a>    iter_dt<span class="sc">$</span>a1[j] <span class="ot">&lt;-</span> a1i<span class="sc">$</span>coefficients[<span class="dv">1</span>]<span class="sc">+</span>a1i<span class="sc">$</span>coefficients[<span class="dv">2</span>]<span class="sc">*</span>iter_dt<span class="sc">$</span>a1[j<span class="dv">-1</span>]</span>
<span id="cb73-23"><a href="tutorial-3-forecasting-methods-and-routines.html#cb73-23" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb73-24"><a href="tutorial-3-forecasting-methods-and-routines.html#cb73-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb73-25"><a href="tutorial-3-forecasting-methods-and-routines.html#cb73-25" aria-hidden="true" tabindex="-1"></a>  <span class="do">## AR(2)</span></span>
<span id="cb73-26"><a href="tutorial-3-forecasting-methods-and-routines.html#cb73-26" aria-hidden="true" tabindex="-1"></a>  iter_dt<span class="sc">$</span>a2[<span class="dv">1</span>] <span class="ot">&lt;-</span> a2i<span class="sc">$</span>coefficients[<span class="dv">1</span>]<span class="sc">+</span>a2i<span class="sc">$</span>coefficients[<span class="dv">2</span>]<span class="sc">*</span>dt[R<span class="sc">+</span>i<span class="dv">-1</span>]<span class="sc">$</span>y<span class="sc">+</span>a2i<span class="sc">$</span>coefficients[<span class="dv">3</span>]<span class="sc">*</span>dt[R<span class="sc">+</span>i<span class="dv">-1</span>]<span class="sc">$</span>y1</span>
<span id="cb73-27"><a href="tutorial-3-forecasting-methods-and-routines.html#cb73-27" aria-hidden="true" tabindex="-1"></a>  iter_dt<span class="sc">$</span>a2[<span class="dv">2</span>] <span class="ot">&lt;-</span> a2i<span class="sc">$</span>coefficients[<span class="dv">1</span>]<span class="sc">+</span>a2i<span class="sc">$</span>coefficients[<span class="dv">2</span>]<span class="sc">*</span>iter_dt<span class="sc">$</span>a2[<span class="dv">1</span>]<span class="sc">+</span>a2i<span class="sc">$</span>coefficients[<span class="dv">3</span>]<span class="sc">*</span>dt[R<span class="sc">+</span>i<span class="dv">-1</span>]<span class="sc">$</span>y</span>
<span id="cb73-28"><a href="tutorial-3-forecasting-methods-and-routines.html#cb73-28" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">3</span><span class="sc">:</span>h){</span>
<span id="cb73-29"><a href="tutorial-3-forecasting-methods-and-routines.html#cb73-29" aria-hidden="true" tabindex="-1"></a>    iter_dt<span class="sc">$</span>a2[j] <span class="ot">&lt;-</span> a2i<span class="sc">$</span>coefficients[<span class="dv">1</span>]<span class="sc">+</span>a2i<span class="sc">$</span>coefficients[<span class="dv">2</span>]<span class="sc">*</span>iter_dt<span class="sc">$</span>a2[j<span class="dv">-1</span>]<span class="sc">+</span>a2i<span class="sc">$</span>coefficients[<span class="dv">3</span>]<span class="sc">*</span>iter_dt<span class="sc">$</span>a2[j<span class="dv">-2</span>]</span>
<span id="cb73-30"><a href="tutorial-3-forecasting-methods-and-routines.html#cb73-30" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb73-31"><a href="tutorial-3-forecasting-methods-and-routines.html#cb73-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-32"><a href="tutorial-3-forecasting-methods-and-routines.html#cb73-32" aria-hidden="true" tabindex="-1"></a>  dt<span class="sc">$</span>a1i[R<span class="sc">+</span>i<span class="sc">+</span>h<span class="dv">-1</span>] <span class="ot">&lt;-</span> iter_dt<span class="sc">$</span>a1[h]</span>
<span id="cb73-33"><a href="tutorial-3-forecasting-methods-and-routines.html#cb73-33" aria-hidden="true" tabindex="-1"></a>  dt<span class="sc">$</span>a2i[R<span class="sc">+</span>i<span class="sc">+</span>h<span class="dv">-1</span>] <span class="ot">&lt;-</span> iter_dt<span class="sc">$</span>a2[h]</span>
<span id="cb73-34"><a href="tutorial-3-forecasting-methods-and-routines.html#cb73-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb73-35"><a href="tutorial-3-forecasting-methods-and-routines.html#cb73-35" aria-hidden="true" tabindex="-1"></a>  <span class="do">### direct multi-step method</span></span>
<span id="cb73-36"><a href="tutorial-3-forecasting-methods-and-routines.html#cb73-36" aria-hidden="true" tabindex="-1"></a>  a1d <span class="ot">&lt;-</span> <span class="fu">lm</span>(y<span class="sc">~</span>y12,<span class="at">data=</span>dt[i<span class="sc">:</span>(R<span class="sc">+</span>i<span class="dv">-1</span>)])</span>
<span id="cb73-37"><a href="tutorial-3-forecasting-methods-and-routines.html#cb73-37" aria-hidden="true" tabindex="-1"></a>  a2d <span class="ot">&lt;-</span> <span class="fu">lm</span>(y<span class="sc">~</span>y12<span class="sc">+</span>y13,<span class="at">data=</span>dt[i<span class="sc">:</span>(R<span class="sc">+</span>i<span class="dv">-1</span>)])</span>
<span id="cb73-38"><a href="tutorial-3-forecasting-methods-and-routines.html#cb73-38" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb73-39"><a href="tutorial-3-forecasting-methods-and-routines.html#cb73-39" aria-hidden="true" tabindex="-1"></a>  dt<span class="sc">$</span>a1d[R<span class="sc">+</span>i<span class="sc">+</span>h<span class="dv">-1</span>] <span class="ot">&lt;-</span> a1d<span class="sc">$</span>coefficients[<span class="dv">1</span>]<span class="sc">+</span>a1d<span class="sc">$</span>coefficients[<span class="dv">2</span>]<span class="sc">*</span>dt[R<span class="sc">+</span>i<span class="dv">-1</span>]<span class="sc">$</span>y</span>
<span id="cb73-40"><a href="tutorial-3-forecasting-methods-and-routines.html#cb73-40" aria-hidden="true" tabindex="-1"></a>  dt<span class="sc">$</span>a2d[R<span class="sc">+</span>i<span class="sc">+</span>h<span class="dv">-1</span>] <span class="ot">&lt;-</span> a2d<span class="sc">$</span>coefficients[<span class="dv">1</span>]<span class="sc">+</span>a2d<span class="sc">$</span>coefficients[<span class="dv">2</span>]<span class="sc">*</span>dt[R<span class="sc">+</span>i<span class="dv">-1</span>]<span class="sc">$</span>y<span class="sc">+</span>a2d<span class="sc">$</span>coefficients[<span class="dv">3</span>]<span class="sc">*</span>dt[R<span class="sc">+</span>i<span class="dv">-1</span>]<span class="sc">$</span>y1</span>
<span id="cb73-41"><a href="tutorial-3-forecasting-methods-and-routines.html#cb73-41" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb73-42"><a href="tutorial-3-forecasting-methods-and-routines.html#cb73-42" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>We can now test whether the forecasts of the iterated method ‘statistically significantly’ outperform those of the direct method?</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="tutorial-3-forecasting-methods-and-routines.html#cb74-1" aria-hidden="true" tabindex="-1"></a>dt<span class="sc">$</span>a1i_e <span class="ot">&lt;-</span> dt<span class="sc">$</span>y<span class="sc">-</span>dt<span class="sc">$</span>a1i</span>
<span id="cb74-2"><a href="tutorial-3-forecasting-methods-and-routines.html#cb74-2" aria-hidden="true" tabindex="-1"></a>dt<span class="sc">$</span>a2i_e <span class="ot">&lt;-</span> dt<span class="sc">$</span>y<span class="sc">-</span>dt<span class="sc">$</span>a2i</span>
<span id="cb74-3"><a href="tutorial-3-forecasting-methods-and-routines.html#cb74-3" aria-hidden="true" tabindex="-1"></a>dt<span class="sc">$</span>a1d_e <span class="ot">&lt;-</span> dt<span class="sc">$</span>y<span class="sc">-</span>dt<span class="sc">$</span>a1d</span>
<span id="cb74-4"><a href="tutorial-3-forecasting-methods-and-routines.html#cb74-4" aria-hidden="true" tabindex="-1"></a>dt<span class="sc">$</span>a2d_e <span class="ot">&lt;-</span> dt<span class="sc">$</span>y<span class="sc">-</span>dt<span class="sc">$</span>a2d</span>
<span id="cb74-5"><a href="tutorial-3-forecasting-methods-and-routines.html#cb74-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-6"><a href="tutorial-3-forecasting-methods-and-routines.html#cb74-6" aria-hidden="true" tabindex="-1"></a>dt<span class="sc">$</span>ld1 <span class="ot">&lt;-</span> dt<span class="sc">$</span>a1d_e<span class="sc">^</span><span class="dv">2</span><span class="sc">-</span>dt<span class="sc">$</span>a1i_e<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb74-7"><a href="tutorial-3-forecasting-methods-and-routines.html#cb74-7" aria-hidden="true" tabindex="-1"></a>dt<span class="sc">$</span>ld2 <span class="ot">&lt;-</span> dt<span class="sc">$</span>a2d_e<span class="sc">^</span><span class="dv">2</span><span class="sc">-</span>dt<span class="sc">$</span>a2i_e<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb74-8"><a href="tutorial-3-forecasting-methods-and-routines.html#cb74-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-9"><a href="tutorial-3-forecasting-methods-and-routines.html#cb74-9" aria-hidden="true" tabindex="-1"></a>reg_ld1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(ld1<span class="sc">~</span><span class="dv">1</span>,<span class="at">data=</span>dt)</span>
<span id="cb74-10"><a href="tutorial-3-forecasting-methods-and-routines.html#cb74-10" aria-hidden="true" tabindex="-1"></a>reg_ld2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(ld2<span class="sc">~</span><span class="dv">1</span>,<span class="at">data=</span>dt)</span>
<span id="cb74-11"><a href="tutorial-3-forecasting-methods-and-routines.html#cb74-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-12"><a href="tutorial-3-forecasting-methods-and-routines.html#cb74-12" aria-hidden="true" tabindex="-1"></a><span class="fu">coeftest</span>(reg_ld1,<span class="at">vcov.=</span><span class="fu">vcovHAC</span>(reg_ld1))</span></code></pre></div>
<pre><code>## 
## t test of coefficients:
## 
##             Estimate Std. Error t value  Pr(&gt;|t|)    
## (Intercept)  -6.9266     1.7170 -4.0342 0.0002828 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="tutorial-3-forecasting-methods-and-routines.html#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coeftest</span>(reg_ld2,<span class="at">vcov.=</span><span class="fu">vcovHAC</span>(reg_ld2))</span></code></pre></div>
<pre><code>## 
## t test of coefficients:
## 
##             Estimate Std. Error t value Pr(&gt;|t|)  
## (Intercept)  -3.1094     1.3271  -2.343  0.02494 *
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
<p>Obtain interval forecasts for horizon 12 using the direct method for an AR(1) model and a linear trend model; plot these interval forecasts along with the observed series.</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="tutorial-3-forecasting-methods-and-routines.html#cb78-1" aria-hidden="true" tabindex="-1"></a>dt<span class="sc">$</span>trend <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(dt))</span>
<span id="cb78-2"><a href="tutorial-3-forecasting-methods-and-routines.html#cb78-2" aria-hidden="true" tabindex="-1"></a>dt[,<span class="st">`</span><span class="at">:=</span><span class="st">`</span>(<span class="at">a1dl=</span><span class="fu">as.numeric</span>(<span class="cn">NA</span>),<span class="at">a1du=</span><span class="fu">as.numeric</span>(<span class="cn">NA</span>),<span class="at">trdl=</span><span class="fu">as.numeric</span>(<span class="cn">NA</span>),<span class="at">trdu=</span><span class="fu">as.numeric</span>(<span class="cn">NA</span>))]</span>
<span id="cb78-3"><a href="tutorial-3-forecasting-methods-and-routines.html#cb78-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-4"><a href="tutorial-3-forecasting-methods-and-routines.html#cb78-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>P){</span>
<span id="cb78-5"><a href="tutorial-3-forecasting-methods-and-routines.html#cb78-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb78-6"><a href="tutorial-3-forecasting-methods-and-routines.html#cb78-6" aria-hidden="true" tabindex="-1"></a>  a1d <span class="ot">&lt;-</span> <span class="fu">lm</span>(y<span class="sc">~</span>y12,<span class="at">data=</span>dt[i<span class="sc">:</span>(R<span class="sc">+</span>i<span class="dv">-1</span>)])</span>
<span id="cb78-7"><a href="tutorial-3-forecasting-methods-and-routines.html#cb78-7" aria-hidden="true" tabindex="-1"></a>  trd <span class="ot">&lt;-</span> <span class="fu">lm</span>(y<span class="sc">~</span>trend,<span class="at">data=</span>dt[i<span class="sc">:</span>(R<span class="sc">+</span>i<span class="dv">-1</span>)])</span>
<span id="cb78-8"><a href="tutorial-3-forecasting-methods-and-routines.html#cb78-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb78-9"><a href="tutorial-3-forecasting-methods-and-routines.html#cb78-9" aria-hidden="true" tabindex="-1"></a>  a1d_pf <span class="ot">&lt;-</span> a1d<span class="sc">$</span>coefficients[<span class="dv">1</span>]<span class="sc">+</span>a1d<span class="sc">$</span>coefficients[<span class="dv">2</span>]<span class="sc">*</span>dt[R<span class="sc">+</span>i<span class="dv">-1</span>]<span class="sc">$</span>y</span>
<span id="cb78-10"><a href="tutorial-3-forecasting-methods-and-routines.html#cb78-10" aria-hidden="true" tabindex="-1"></a>  trd_pf <span class="ot">&lt;-</span> trd<span class="sc">$</span>coefficients[<span class="dv">1</span>]<span class="sc">+</span>trd<span class="sc">$</span>coefficients[<span class="dv">2</span>]<span class="sc">*</span>dt[R<span class="sc">+</span>i<span class="dv">-1</span><span class="sc">+</span>h]<span class="sc">$</span>trend</span>
<span id="cb78-11"><a href="tutorial-3-forecasting-methods-and-routines.html#cb78-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb78-12"><a href="tutorial-3-forecasting-methods-and-routines.html#cb78-12" aria-hidden="true" tabindex="-1"></a>  a1d_sd <span class="ot">&lt;-</span> <span class="fu">summary</span>(a1d)<span class="sc">$</span>sigma</span>
<span id="cb78-13"><a href="tutorial-3-forecasting-methods-and-routines.html#cb78-13" aria-hidden="true" tabindex="-1"></a>  trd_sd <span class="ot">&lt;-</span> <span class="fu">summary</span>(trd)<span class="sc">$</span>sigma</span>
<span id="cb78-14"><a href="tutorial-3-forecasting-methods-and-routines.html#cb78-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb78-15"><a href="tutorial-3-forecasting-methods-and-routines.html#cb78-15" aria-hidden="true" tabindex="-1"></a>  dt<span class="sc">$</span>a1dl[R<span class="sc">+</span>i<span class="sc">+</span>h<span class="dv">-1</span>] <span class="ot">&lt;-</span> a1d_pf<span class="fl">-1.96</span><span class="sc">*</span>a1d_sd</span>
<span id="cb78-16"><a href="tutorial-3-forecasting-methods-and-routines.html#cb78-16" aria-hidden="true" tabindex="-1"></a>  dt<span class="sc">$</span>a1du[R<span class="sc">+</span>i<span class="sc">+</span>h<span class="dv">-1</span>] <span class="ot">&lt;-</span> a1d_pf<span class="fl">+1.96</span><span class="sc">*</span>a1d_sd</span>
<span id="cb78-17"><a href="tutorial-3-forecasting-methods-and-routines.html#cb78-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb78-18"><a href="tutorial-3-forecasting-methods-and-routines.html#cb78-18" aria-hidden="true" tabindex="-1"></a>  dt<span class="sc">$</span>trdl[R<span class="sc">+</span>i<span class="sc">+</span>h<span class="dv">-1</span>] <span class="ot">&lt;-</span> trd_pf<span class="fl">-1.96</span><span class="sc">*</span>trd_sd</span>
<span id="cb78-19"><a href="tutorial-3-forecasting-methods-and-routines.html#cb78-19" aria-hidden="true" tabindex="-1"></a>  dt<span class="sc">$</span>trdu[R<span class="sc">+</span>i<span class="sc">+</span>h<span class="dv">-1</span>] <span class="ot">&lt;-</span> trd_pf<span class="fl">+1.96</span><span class="sc">*</span>trd_sd</span>
<span id="cb78-20"><a href="tutorial-3-forecasting-methods-and-routines.html#cb78-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb78-21"><a href="tutorial-3-forecasting-methods-and-routines.html#cb78-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-22"><a href="tutorial-3-forecasting-methods-and-routines.html#cb78-22" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dt,<span class="fu">aes</span>(<span class="at">x=</span>date,<span class="at">y=</span>y))<span class="sc">+</span></span>
<span id="cb78-23"><a href="tutorial-3-forecasting-methods-and-routines.html#cb78-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size=</span><span class="dv">1</span>,<span class="at">color=</span><span class="st">"black"</span>)<span class="sc">+</span></span>
<span id="cb78-24"><a href="tutorial-3-forecasting-methods-and-routines.html#cb78-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y=</span>a1dl),<span class="at">size=</span><span class="dv">1</span>,<span class="at">color=</span><span class="st">"steelblue"</span>,<span class="at">linetype=</span><span class="dv">5</span>,<span class="at">na.rm=</span>T)<span class="sc">+</span></span>
<span id="cb78-25"><a href="tutorial-3-forecasting-methods-and-routines.html#cb78-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y=</span>a1du),<span class="at">size=</span><span class="dv">1</span>,<span class="at">color=</span><span class="st">"steelblue"</span>,<span class="at">linetype=</span><span class="dv">5</span>,<span class="at">na.rm=</span>T)<span class="sc">+</span></span>
<span id="cb78-26"><a href="tutorial-3-forecasting-methods-and-routines.html#cb78-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y=</span>trdl),<span class="at">size=</span><span class="dv">1</span>,<span class="at">color=</span><span class="st">"indianred"</span>,<span class="at">linetype=</span><span class="dv">5</span>,<span class="at">na.rm=</span>T)<span class="sc">+</span></span>
<span id="cb78-27"><a href="tutorial-3-forecasting-methods-and-routines.html#cb78-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y=</span>trdu),<span class="at">size=</span><span class="dv">1</span>,<span class="at">color=</span><span class="st">"indianred"</span>,<span class="at">linetype=</span><span class="dv">5</span>,<span class="at">na.rm=</span>T)<span class="sc">+</span></span>
<span id="cb78-28"><a href="tutorial-3-forecasting-methods-and-routines.html#cb78-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="forecasting_files/figure-html/unnamed-chunk-59-1.png" width="624"></p>
<p>Test the unconditional coverage of the interval forecasts from the considered two models.</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="tutorial-3-forecasting-methods-and-routines.html#cb79-1" aria-hidden="true" tabindex="-1"></a>dt[,<span class="st">`</span><span class="at">:=</span><span class="st">`</span>(<span class="at">i1=</span><span class="fu">ifelse</span>(y<span class="sc">&gt;=</span>a1dl <span class="sc">&amp;</span> y<span class="sc">&lt;=</span>a1du,<span class="dv">1</span>,<span class="dv">0</span>),<span class="at">it=</span><span class="fu">ifelse</span>(y<span class="sc">&gt;=</span>trdl <span class="sc">&amp;</span> y<span class="sc">&lt;=</span>trdu,<span class="dv">1</span>,<span class="dv">0</span>))]</span>
<span id="cb79-2"><a href="tutorial-3-forecasting-methods-and-routines.html#cb79-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-3"><a href="tutorial-3-forecasting-methods-and-routines.html#cb79-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-4"><a href="tutorial-3-forecasting-methods-and-routines.html#cb79-4" aria-hidden="true" tabindex="-1"></a><span class="co"># AR(1)</span></span>
<span id="cb79-5"><a href="tutorial-3-forecasting-methods-and-routines.html#cb79-5" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">mean</span>(dt<span class="sc">$</span>i1,<span class="at">na.rm=</span>T)</span>
<span id="cb79-6"><a href="tutorial-3-forecasting-methods-and-routines.html#cb79-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-7"><a href="tutorial-3-forecasting-methods-and-routines.html#cb79-7" aria-hidden="true" tabindex="-1"></a>L10 <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="fl">-.95</span>)<span class="sc">^</span>(P<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>p1))<span class="sc">*</span>(.<span class="dv">95</span>)<span class="sc">^</span>(P<span class="sc">*</span>p1)</span>
<span id="cb79-8"><a href="tutorial-3-forecasting-methods-and-routines.html#cb79-8" aria-hidden="true" tabindex="-1"></a>L11 <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="sc">-</span>p1)<span class="sc">^</span>(P<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>p1))<span class="sc">*</span>(p1)<span class="sc">^</span>(P<span class="sc">*</span>p1)</span>
<span id="cb79-9"><a href="tutorial-3-forecasting-methods-and-routines.html#cb79-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-10"><a href="tutorial-3-forecasting-methods-and-routines.html#cb79-10" aria-hidden="true" tabindex="-1"></a>LR1 <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">2</span><span class="sc">*</span><span class="fu">log</span>(L10<span class="sc">/</span>L11)</span>
<span id="cb79-11"><a href="tutorial-3-forecasting-methods-and-routines.html#cb79-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-12"><a href="tutorial-3-forecasting-methods-and-routines.html#cb79-12" aria-hidden="true" tabindex="-1"></a><span class="fu">pchisq</span>(LR1,<span class="at">df=</span><span class="dv">1</span>,<span class="at">lower.tail=</span>F)</span></code></pre></div>
<pre><code>## [1] 0.01027851</code></pre>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="tutorial-3-forecasting-methods-and-routines.html#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co"># AR(2)</span></span>
<span id="cb81-2"><a href="tutorial-3-forecasting-methods-and-routines.html#cb81-2" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">mean</span>(dt<span class="sc">$</span>it,<span class="at">na.rm=</span>T)</span>
<span id="cb81-3"><a href="tutorial-3-forecasting-methods-and-routines.html#cb81-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-4"><a href="tutorial-3-forecasting-methods-and-routines.html#cb81-4" aria-hidden="true" tabindex="-1"></a>L20 <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="fl">-.95</span>)<span class="sc">^</span>(P<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>p2))<span class="sc">*</span>(.<span class="dv">95</span>)<span class="sc">^</span>(P<span class="sc">*</span>p2)</span>
<span id="cb81-5"><a href="tutorial-3-forecasting-methods-and-routines.html#cb81-5" aria-hidden="true" tabindex="-1"></a>L21 <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="sc">-</span>p2)<span class="sc">^</span>(P<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>p2))<span class="sc">*</span>(p2)<span class="sc">^</span>(P<span class="sc">*</span>p2)</span>
<span id="cb81-6"><a href="tutorial-3-forecasting-methods-and-routines.html#cb81-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-7"><a href="tutorial-3-forecasting-methods-and-routines.html#cb81-7" aria-hidden="true" tabindex="-1"></a>LR2 <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">2</span><span class="sc">*</span><span class="fu">log</span>(L20<span class="sc">/</span>L21)</span>
<span id="cb81-8"><a href="tutorial-3-forecasting-methods-and-routines.html#cb81-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-9"><a href="tutorial-3-forecasting-methods-and-routines.html#cb81-9" aria-hidden="true" tabindex="-1"></a><span class="fu">pchisq</span>(LR2,<span class="at">df=</span><span class="dv">1</span>,<span class="at">lower.tail=</span>F)</span></code></pre></div>
<pre><code>## [1] 0.1441849</code></pre>

</div>
<p style="text-align: center;">
<a href="tutorial-2-data-management.html"><button class="btn btn-default">Previous</button></a>
<a href="tutorial-4-trends-and-seasonality.html"><button class="btn btn-default">Next</button></a>
</p>
<p class="build-date">Page built: 
2022-07-19
 using 
R version 4.1.2 (2021-11-01)
</p>
</div>
</div>



</body>
</html>
